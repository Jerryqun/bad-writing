"use strict";(self.webpackChunkblog_cq=self.webpackChunkblog_cq||[]).push([[5060],{55352:function(r,l,a){a.r(l);var d=a(72269),c=a(93359),x=a(61788),p=a(19977),v=a(91558),n=a(24268),I=a(96057),h=a(85939),s=a(53683),o=a(80936),i=a(67294),e=a(84430),t=a(85893);function u(){return(0,t.jsx)(s.dY,{children:(0,t.jsx)(i.Suspense,{fallback:(0,t.jsx)(o.Z,{}),children:(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"markdown",children:[(0,t.jsxs)("h2",{id:"\u524D\u8A00",children:[(0,t.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u524D\u8A00",children:(0,t.jsx)("span",{className:"icon icon-link"})}),"\u524D\u8A00"]}),(0,t.jsx)("p",{children:e.texts[0].value}),(0,t.jsxs)("p",{children:[e.texts[1].value,(0,t.jsx)("code",{children:e.texts[2].value}),e.texts[3].value]}),(0,t.jsxs)("h2",{id:"\u6E29\u6545\u800C\u77E5\u65B0",children:[(0,t.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u6E29\u6545\u800C\u77E5\u65B0",children:(0,t.jsx)("span",{className:"icon icon-link"})}),"\u6E29\u6545\u800C\u77E5\u65B0"]}),(0,t.jsxs)("p",{children:[e.texts[4].value,(0,t.jsx)("code",{children:e.texts[5].value}),e.texts[6].value]}),(0,t.jsx)(n.Z,{lang:"html",children:e.texts[7].value}),(0,t.jsxs)("p",{children:[e.texts[8].value,(0,t.jsx)("code",{children:e.texts[9].value}),e.texts[10].value,(0,t.jsx)("code",{children:e.texts[11].value}),e.texts[12].value,(0,t.jsx)("code",{children:e.texts[13].value}),e.texts[14].value]}),(0,t.jsxs)("p",{children:[e.texts[15].value,(0,t.jsx)("code",{children:e.texts[16].value}),e.texts[17].value,(0,t.jsx)("code",{children:e.texts[18].value}),e.texts[19].value]}),(0,t.jsxs)("ol",{children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("code",{children:e.texts[20].value}),e.texts[21].value]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("code",{children:e.texts[22].value}),e.texts[23].value]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("code",{children:e.texts[24].value}),e.texts[25].value]})]}),(0,t.jsxs)("p",{children:[e.texts[26].value,(0,t.jsx)("code",{children:e.texts[27].value}),e.texts[28].value,(0,t.jsx)("code",{children:e.texts[29].value}),e.texts[30].value]}),(0,t.jsx)(n.Z,{lang:"js",children:e.texts[31].value}),(0,t.jsxs)("h2",{id:"\u7B2C\u4E00\u79CD\u65B9\u5F0Fapi-\u63A5\u53E3",children:[(0,t.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u7B2C\u4E00\u79CD\u65B9\u5F0Fapi-\u63A5\u53E3",children:(0,t.jsx)("span",{className:"icon icon-link"})}),"\u7B2C\u4E00\u79CD\u65B9\u5F0F\uFF1AAPI \u63A5\u53E3"]}),(0,t.jsxs)("p",{children:[e.texts[32].value,(0,t.jsx)("code",{children:e.texts[33].value}),e.texts[34].value]}),(0,t.jsx)("p",{children:e.texts[35].value}),(0,t.jsxs)("p",{children:[e.texts[36].value,(0,t.jsx)("code",{children:e.texts[37].value}),e.texts[38].value,(0,t.jsx)("code",{children:e.texts[39].value}),e.texts[40].value,(0,t.jsx)("code",{children:e.texts[41].value}),e.texts[42].value,(0,t.jsx)("code",{children:e.texts[43].value}),e.texts[44].value,(0,t.jsx)("code",{children:e.texts[45].value}),e.texts[46].value,(0,t.jsx)("code",{children:e.texts[47].value}),e.texts[48].value]}),(0,t.jsx)("p",{children:e.texts[49].value}),(0,t.jsx)("p",{children:(0,t.jsx)("img",{alt:"alt text",src:a(74785)})}),(0,t.jsxs)("p",{children:[e.texts[50].value,(0,t.jsx)("code",{children:e.texts[51].value}),e.texts[52].value]}),(0,t.jsx)(n.Z,{lang:"js",children:e.texts[53].value}),(0,t.jsxs)("p",{children:[e.texts[54].value,(0,t.jsx)("code",{children:e.texts[55].value}),e.texts[56].value]}),(0,t.jsx)(n.Z,{lang:"js",children:e.texts[57].value}),(0,t.jsxs)("p",{children:[e.texts[58].value,(0,t.jsx)("code",{children:e.texts[59].value}),e.texts[60].value]}),(0,t.jsx)("p",{children:(0,t.jsx)("img",{alt:"alt text",src:a(17992)})}),(0,t.jsx)("p",{children:e.texts[61].value}),(0,t.jsxs)("p",{children:[e.texts[62].value,(0,t.jsx)("code",{children:e.texts[63].value}),e.texts[64].value]}),(0,t.jsx)(n.Z,{lang:"js",children:e.texts[65].value}),(0,t.jsxs)("p",{children:[e.texts[66].value,(0,t.jsx)("code",{children:e.texts[67].value}),e.texts[68].value,(0,t.jsx)("code",{children:e.texts[69].value}),e.texts[70].value,(0,t.jsx)("code",{children:e.texts[71].value}),e.texts[72].value,(0,t.jsx)("a",{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/FormData",children:e.texts[73].value}),e.texts[74].value,(0,t.jsx)("a",{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/File",children:e.texts[75].value}),e.texts[76].value,(0,t.jsx)("code",{children:e.texts[77].value}),e.texts[78].value]}),(0,t.jsxs)("p",{children:[e.texts[79].value,(0,t.jsx)("a",{href:"https://juejin.cn/book/7307859898316881957/section/7309079651500949530#heading-58",children:e.texts[80].value}),e.texts[81].value,(0,t.jsx)("a",{href:"https://juejin.cn/book/7307859898316881957/section/7309079651500949530#heading-44",children:e.texts[82].value}),e.texts[83].value,(0,t.jsx)("a",{href:"https://juejin.cn/book/7307859898316881957/section/7309079651500949530#heading-58",children:e.texts[84].value}),e.texts[85].value]}),(0,t.jsxs)("p",{children:[e.texts[86].value,(0,t.jsx)("code",{children:e.texts[87].value}),e.texts[88].value]}),(0,t.jsx)(n.Z,{lang:"js",children:e.texts[89].value}),(0,t.jsxs)("p",{children:[e.texts[90].value,(0,t.jsx)("a",{href:"https://www.npmjs.com/package/mime",children:e.texts[91].value}),e.texts[92].value,(0,t.jsx)("code",{children:e.texts[93].value}),e.texts[94].value,(0,t.jsx)("code",{children:e.texts[95].value}),e.texts[96].value]}),(0,t.jsx)(n.Z,{lang:"js",children:e.texts[97].value}),(0,t.jsxs)("p",{children:[e.texts[98].value,(0,t.jsx)("code",{children:e.texts[99].value}),e.texts[100].value,(0,t.jsx)("code",{children:e.texts[101].value}),e.texts[102].value,(0,t.jsx)("code",{children:e.texts[103].value}),e.texts[104].value,(0,t.jsx)("code",{children:e.texts[105].value}),e.texts[106].value]}),(0,t.jsxs)("p",{children:[e.texts[107].value,(0,t.jsx)("code",{children:e.texts[108].value}),e.texts[109].value,(0,t.jsx)("code",{children:e.texts[110].value}),e.texts[111].value]}),(0,t.jsxs)("p",{children:[e.texts[112].value,(0,t.jsx)("code",{children:e.texts[113].value}),e.texts[114].value,(0,t.jsx)("code",{children:e.texts[115].value}),e.texts[116].value,(0,t.jsx)("code",{children:e.texts[117].value}),e.texts[118].value]}),(0,t.jsx)("p",{children:e.texts[119].value}),(0,t.jsxs)("p",{children:[e.texts[120].value,(0,t.jsx)("code",{children:e.texts[121].value}),e.texts[122].value]}),(0,t.jsxs)("p",{children:[e.texts[123].value,(0,t.jsx)("code",{children:e.texts[124].value}),e.texts[125].value,(0,t.jsx)("a",{href:"https://juejin.cn/book/7307859898316881957/section/7309077169735958565#heading-18",children:e.texts[126].value}),e.texts[127].value,(0,t.jsx)("a",{href:"https://github.com/vercel/next.js/discussions/54075",children:e.texts[128].value}),e.texts[129].value]}),(0,t.jsx)("p",{children:(0,t.jsx)("img",{alt:"alt text",src:a(98122)})}),(0,t.jsxs)("p",{children:[e.texts[130].value,(0,t.jsx)("code",{children:e.texts[131].value}),e.texts[132].value]}),(0,t.jsx)(n.Z,{lang:"js",children:e.texts[133].value}),(0,t.jsxs)("p",{children:[e.texts[134].value,(0,t.jsx)("code",{children:e.texts[135].value}),e.texts[136].value]}),(0,t.jsx)(n.Z,{lang:"js",children:e.texts[137].value}),(0,t.jsxs)("p",{children:[e.texts[138].value,(0,t.jsx)("code",{children:e.texts[139].value}),e.texts[140].value]}),(0,t.jsx)("p",{children:(0,t.jsx)("img",{alt:"alt text",src:a(93376)})}),(0,t.jsxs)("p",{children:[e.texts[141].value,(0,t.jsx)("code",{children:e.texts[142].value}),e.texts[143].value,(0,t.jsx)("code",{children:e.texts[144].value}),e.texts[145].value]}),(0,t.jsx)("p",{children:(0,t.jsx)("img",{alt:"alt text",src:a(68400)})}),(0,t.jsx)("p",{children:e.texts[146].value}),(0,t.jsxs)("h2",{id:"\u7B2C\u4E8C\u79CD\u65B9\u5F0Fserver-actions",children:[(0,t.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u7B2C\u4E8C\u79CD\u65B9\u5F0Fserver-actions",children:(0,t.jsx)("span",{className:"icon icon-link"})}),"\u7B2C\u4E8C\u79CD\u65B9\u5F0F\uFF1AServer Actions"]}),(0,t.jsxs)("p",{children:[e.texts[147].value,(0,t.jsx)("a",{href:"https://github.com/vercel/next.js/tree/canary/examples/server-actions-upload",children:e.texts[148].value}),e.texts[149].value]}),(0,t.jsxs)("p",{children:[e.texts[150].value,(0,t.jsx)("code",{children:e.texts[151].value}),e.texts[152].value,(0,t.jsx)("code",{children:e.texts[153].value}),e.texts[154].value,(0,t.jsx)("code",{children:e.texts[155].value}),e.texts[156].value,(0,t.jsx)("code",{children:e.texts[157].value}),e.texts[158].value,(0,t.jsx)("code",{children:e.texts[159].value}),e.texts[160].value]}),(0,t.jsxs)("p",{children:[e.texts[161].value,(0,t.jsx)("code",{children:e.texts[162].value}),e.texts[163].value,(0,t.jsx)("code",{children:e.texts[164].value}),e.texts[165].value]}),(0,t.jsx)(n.Z,{lang:"js",children:e.texts[166].value}),(0,t.jsxs)("p",{children:[e.texts[167].value,(0,t.jsx)("code",{children:e.texts[168].value}),e.texts[169].value]}),(0,t.jsx)(n.Z,{lang:"js",children:e.texts[170].value}),(0,t.jsxs)("p",{children:[e.texts[171].value,(0,t.jsx)("code",{children:e.texts[172].value}),e.texts[173].value]}),(0,t.jsx)(n.Z,{lang:"js",children:e.texts[174].value}),(0,t.jsxs)("p",{children:[e.texts[175].value,(0,t.jsx)("code",{children:e.texts[176].value}),e.texts[177].value,(0,t.jsx)("code",{children:e.texts[178].value}),e.texts[179].value]}),(0,t.jsx)(n.Z,{lang:"js",children:e.texts[180].value}),(0,t.jsx)("p",{children:e.texts[181].value}),(0,t.jsxs)("p",{children:[e.texts[182].value,(0,t.jsx)("code",{children:e.texts[183].value}),e.texts[184].value]}),(0,t.jsx)("p",{children:e.texts[185].value}),(0,t.jsx)("p",{children:e.texts[186].value}),(0,t.jsxs)("p",{children:[e.texts[187].value,(0,t.jsx)("code",{children:e.texts[188].value}),e.texts[189].value]}),(0,t.jsx)(n.Z,{lang:"js",children:e.texts[190].value}),(0,t.jsxs)("p",{children:[(0,t.jsx)("code",{children:e.texts[191].value}),e.texts[192].value]}),(0,t.jsxs)("h2",{id:"\u603B\u7ED3",children:[(0,t.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u603B\u7ED3",children:(0,t.jsx)("span",{className:"icon icon-link"})}),"\u603B\u7ED3"]}),(0,t.jsx)("p",{children:e.texts[193].value}),(0,t.jsxs)("p",{children:[e.texts[194].value,(0,t.jsx)("a",{href:"https://github.com/mqyqingfeng/next-react-notes-demo/tree/main",children:e.texts[195].value}),e.texts[196].value]}),(0,t.jsxs)("ul",{children:[(0,t.jsxs)("li",{children:[e.texts[197].value,(0,t.jsx)("a",{href:"https://github.com/mqyqingfeng/next-react-notes-demo/tree/day7",children:e.texts[198].value}),e.texts[199].value]}),(0,t.jsxs)("li",{children:[e.texts[200].value,(0,t.jsx)("a",{href:"https://github.com/mqyqingfeng/next-react-notes-demo/tree/day7-1",children:e.texts[201].value}),e.texts[202].value]}),(0,t.jsxs)("li",{children:[e.texts[203].value,(0,t.jsx)("a",{href:"https://github.com/mqyqingfeng/next-react-notes-demo/tree/day7-2",children:e.texts[204].value}),e.texts[205].value]})]}),(0,t.jsx)("p",{children:e.texts[206].value}),(0,t.jsxs)("h2",{id:"\u53C2\u8003\u94FE\u63A5",children:[(0,t.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u53C2\u8003\u94FE\u63A5",children:(0,t.jsx)("span",{className:"icon icon-link"})}),"\u53C2\u8003\u94FE\u63A5"]}),(0,t.jsxs)("ol",{children:[(0,t.jsx)("li",{children:(0,t.jsx)("a",{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/input/file#accept",children:e.texts[207].value})}),(0,t.jsx)("li",{children:(0,t.jsx)("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/enctype",children:e.texts[208].value})}),(0,t.jsx)("li",{children:(0,t.jsx)("a",{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/File",children:e.texts[209].value})}),(0,t.jsx)("li",{children:(0,t.jsx)("a",{href:"https://codersteps.com/articles/building-a-file-uploader-from-scratch-with-next-js-app-directory",children:e.texts[210].value})}),(0,t.jsx)("li",{children:(0,t.jsx)("a",{href:"https://ethanmick.com/how-to-upload-a-file-in-next-js-13-app-directory/",children:e.texts[211].value})}),(0,t.jsx)("li",{children:(0,t.jsx)("a",{href:"https://stackoverflow.com/questions/76395110/next-js-v13-revalidate-not-triggering-after-router-push",children:e.texts[212].value})}),(0,t.jsx)("li",{children:(0,t.jsx)("a",{href:"https://github.com/vercel/next.js/discussions/54075",children:e.texts[213].value})})]})]})})})})}l.default=u},84430:function(r,l,a){a.r(l),a.d(l,{texts:function(){return d}});const d=[{value:"\u672C\u7BC7\u6211\u4EEC\u6765\u5B9E\u73B0\u6587\u4EF6\u4E0A\u4F20\u529F\u80FD\u3002",paraId:0,tocIndex:0},{value:"\u4E3A\u6B64\u6211\u4EEC\u5B9E\u73B0\u8FD9\u6837\u4E00\u4E2A\u9700\u6C42\uFF1A\u70B9\u51FB\u6DFB\u52A0\u6309\u94AE\uFF0C\u4E0A\u4F20\u672C\u5730\u7684 ",paraId:1,tocIndex:0},{value:".md",paraId:1,tocIndex:0},{value:"\u6587\u4EF6\uFF0C\u8BFB\u53D6\u6587\u4EF6\u5185\u5BB9\uFF0C\u65B0\u5EFA\u4E00\u6761\u7B14\u8BB0\u3002\u6548\u679C\u5982\u4E0B\uFF1A",paraId:1,tocIndex:0},{value:"\u6211\u4EEC\u5148\u56DE\u5FC6\u4E0B\u6587\u4EF6\u4E0A\u4F20\u529F\u80FD\uFF0C\u901A\u5E38\u662F\u7528 ",paraId:2,tocIndex:1},{value:'<input type="file">',paraId:2,tocIndex:1},{value:"\uFF0C\u793A\u4F8B\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:2,tocIndex:1},{value:`<form method="post" enctype="multipart/form-data">
  <div>
    <label for="file">\u9009\u62E9\u8981\u4E0A\u4F20\u7684\u6587\u4EF6</label>
    <input type="file" id="file" name="file" multiple accept="image/*,.pdf" />
  </div>
  <div>
    <button>\u63D0\u4EA4</button>
  </div>
</form>
`,paraId:3,tocIndex:1},{value:"\u5176\u4E2D ",paraId:4,tocIndex:1},{value:'<input type="file" >',paraId:4,tocIndex:1},{value:" \u5982\u679C\u6709\u9644\u52A0\u5C5E\u6027 ",paraId:4,tocIndex:1},{value:"multiple",paraId:4,tocIndex:1},{value:"\uFF0C\u8868\u793A\u5141\u8BB8\u7528\u6237\u9009\u62E9\u591A\u4E2A\u6587\u4EF6\u3002\u5982\u679C\u6709\u9644\u52A0\u5C5E\u6027 ",paraId:4,tocIndex:1},{value:"accept",paraId:4,tocIndex:1},{value:"\u8868\u793A\u652F\u6301\u7684\u6587\u4EF6\u7C7B\u578B\uFF0C\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\u8868\u793A\u7684\u662F\u652F\u6301\u56FE\u7247\u683C\u5F0F\u548C pdf \u6587\u4EF6\u3002",paraId:4,tocIndex:1},{value:"\u5176\u4E2D ",paraId:5,tocIndex:1},{value:"<form>",paraId:5,tocIndex:1},{value:" \u6DFB\u52A0\u4E86\u5C5E\u6027 ",paraId:5,tocIndex:1},{value:"enctype",paraId:5,tocIndex:1},{value:" \u7528\u4E8E\u6307\u660E\u63D0\u4EA4\u8868\u5355\u7684\u5185\u5BB9\u7C7B\u578B\uFF0C\u53EF\u9009\u7684\u503C\u6709 3 \u4E2A\uFF1A",paraId:5,tocIndex:1},{value:"application/x-www-form-urlencoded",paraId:6,tocIndex:1},{value:"\uFF1A\u6240\u6709\u5B57\u7B26\u5728\u53D1\u9001\u524D\u90FD\u4F1A\u88AB\u7F16\u7801\u3002\u7A7A\u683C\u4F1A\u8F6C\u6362\u4E3A\u201C+\u201D\u7B26\u53F7\uFF0C\u7279\u6B8A\u5B57\u7B26\u4F1A\u8F6C\u6362\u4E3A ASCII \u5341\u516D\u8FDB\u5236\u503C\uFF0C\u9002\u7528\u4E8E\u666E\u901A\u7684\u8868\u5355\u6570\u636E",paraId:6,tocIndex:1},{value:"multipart/form-data",paraId:6,tocIndex:1},{value:"\uFF1A\u4E0D\u5BF9\u5B57\u7B26\u7F16\u7801\u3002\u5982\u679C\u8868\u5355\u4E2D\u6709\u4E0A\u4F20\u6587\u4EF6\uFF0C\u4F7F\u7528\u8FD9\u4E2A",paraId:6,tocIndex:1},{value:"text/plain",paraId:6,tocIndex:1},{value:"\uFF1A\u53D1\u9001\u6570\u636E\u65F6\u5B8C\u5168\u4E0D\u8FDB\u884C\u4EFB\u4F55\u7F16\u7801\u3002\u7528\u7684\u5F88\u5C11",paraId:6,tocIndex:1},{value:"\u56E0\u4E3A ",paraId:7,tocIndex:1},{value:'<input type="file">',paraId:7,tocIndex:1},{value:" \u9ED8\u8BA4\u7684\u6837\u5F0F\u65E0\u6CD5\u6539\u53D8\uFF0C\u901A\u5E38\u4F1A\u4F7F\u7528 ",paraId:7,tocIndex:1},{value:"label",paraId:7,tocIndex:1},{value:" \u6807\u7B7E\u5173\u8054\uFF0C\u9690\u85CF input \u6807\u7B7E\uFF1A",paraId:7,tocIndex:1},{value:`<form method="post" enctype="multipart/form-data">
  <div>
    <label for="file">Import .md File</label>
    <input
      type="file"
      id="file"
      name="file"
      multiple
      style={{ position: 'absolute', clip: 'rect(0 0 0 0)' }}
    />
  </div>
  <div>
    <button>\u63D0\u4EA4</button>
  </div>
</form>
`,paraId:8,tocIndex:1},{value:"\u73B0\u5728\u8BA9\u6211\u4EEC\u5F00\u59CB\u5199\u5427\uFF01\u7B80\u5355\u8D77\u89C1\uFF0C\u6211\u4EEC\u7684\u4EE3\u7801\u4F7F\u7528 ",paraId:9,tocIndex:2},{value:"day5-2",paraId:9,tocIndex:2},{value:"\u5206\u652F\u7684\u4EE3\u7801\uFF0C\u4E5F\u5C31\u662F\u6CA1\u6709\u5B9E\u73B0\u56FD\u9645\u5316\u4E4B\u524D\u7684\u9879\u76EE\u3002",paraId:9,tocIndex:2},{value:"\u7B2C\u4E00\u79CD\u5B9E\u73B0\u65B9\u5F0F\u662F\u4F7F\u7528 API \u63A5\u53E3\uFF0C\u5728\u5BA2\u6237\u7AEF\u63D0\u4EA4\u6587\u4EF6\u7684\u65F6\u5019\uFF0C\u8C03\u7528\u540E\u7AEF\u7684\u63A5\u53E3\u8FDB\u884C\u5904\u7406\u3002",paraId:10,tocIndex:2},{value:"\u5B9E\u73B0\u63D0\u4EA4\u6587\u4EF6\u529F\u80FD\uFF0C\u4F60\u9700\u8981\u76D1\u542C ",paraId:11,tocIndex:2},{value:'<input type="file">',paraId:11,tocIndex:2},{value:" \u7684 ",paraId:11,tocIndex:2},{value:"onChange",paraId:11,tocIndex:2},{value:" \u4E8B\u4EF6\u6216\u8005\u662F ",paraId:11,tocIndex:2},{value:"<button>",paraId:11,tocIndex:2},{value:" \u7684 ",paraId:11,tocIndex:2},{value:"onClick",paraId:11,tocIndex:2},{value:" \u4E8B\u4EF6\uFF0C\u53C8\u6216\u8005\u662F ",paraId:11,tocIndex:2},{value:"<form>",paraId:11,tocIndex:2},{value:" \u7684 ",paraId:11,tocIndex:2},{value:"onSubmit",paraId:11,tocIndex:2},{value:" \u4E8B\u4EF6\uFF0C\u65E0\u8BBA\u54EA\u79CD\uFF0C\u53CD\u6B63\u4F60\u9700\u8981\u5199\u6210\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u3002",paraId:11,tocIndex:2},{value:"\u4E0A\u4F20\u6587\u4EF6\u7684\u5165\u53E3\uFF0C\u6211\u4EEC\u5C31\u5199\u5728\u7B14\u8BB0\u5217\u8868\u7684\u4E0B\u65B9\uFF1A",paraId:12,tocIndex:2},{value:"\u65B0\u5EFA ",paraId:13,tocIndex:2},{value:"components/SidebarImport.js",paraId:13,tocIndex:2},{value:"\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:13,tocIndex:2},{value:`'use client';

import React, { Suspense } from 'react';

export default function SidebarImport() {
  return (
    <form method="post" enctype="multipart/form-data">
      <div style={{ textAlign: 'center' }}>
        <label for="file" style={{ cursor: 'pointer' }}>
          Import .md File
        </label>
        <input
          type="file"
          id="file"
          name="file"
          multiple
          style={{ position: 'absolute', clip: 'rect(0 0 0 0)' }}
        />
      </div>
    </form>
  );
}
`,paraId:14,tocIndex:2},{value:"\u5728 ",paraId:15,tocIndex:2},{value:"components/Sidebar.js",paraId:15,tocIndex:2},{value:"\u4E2D\u5BFC\u5165\u8BE5\u7EC4\u4EF6\uFF1A",paraId:15,tocIndex:2},{value:`// ...
import SidebarImport from '@/components/SidebarImport';

export default function Sidebar() {
  // ...
  return (
    <>
      <section className="col sidebar">
        // ...
        <nav>
          <Suspense fallback={<NoteListSkeleton />}>
            <SidebarNoteList />
          </Suspense>
        </nav>
        <SidebarImport />
      </section>
    </>
  );
}
`,paraId:16,tocIndex:2},{value:"\u6B64\u65F6\u70B9\u51FB ",paraId:17,tocIndex:2},{value:"Import .md File",paraId:17,tocIndex:2},{value:" \u5DF2\u7ECF\u80FD\u591F\u6B63\u5E38\u8C03\u8D77\u6587\u4EF6\u9009\u62E9\u6846\uFF1A",paraId:17,tocIndex:2},{value:"\u73B0\u5728\u8BA9\u6211\u4EEC\u6765\u5B8C\u5584\u6548\u679C\u5427\uFF01",paraId:18,tocIndex:2},{value:"\u4FEE\u6539 ",paraId:19,tocIndex:2},{value:"components/SidebarImport.js",paraId:19,tocIndex:2},{value:"\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:19,tocIndex:2},{value:`'use client';

import React, { Suspense } from 'react';
import { useRouter } from 'next/navigation';

export default function SidebarImport() {
  const router = useRouter();

  const onChange = async (e) => {
    const fileInput = e.target;

    if (!fileInput.files || fileInput.files.length === 0) {
      console.warn('files list is empty');
      return;
    }

    const file = fileInput.files[0];

    const formData = new FormData();
    formData.append('file', file);

    try {
      const response = await fetch('/api/upload', {
        method: 'POST',
        body: formData,
      });

      if (!response.ok) {
        console.error('something went wrong');
        return;
      }

      const data = await response.json();
      router.push(\`/note/\${data.uid}\`);
    } catch (error) {
      console.error('something went wrong');
    }

    // \u91CD\u7F6E file input
    e.target.type = 'text';
    e.target.type = 'file';
  };

  return (
    <div style={{ textAlign: 'center' }}>
      <label htmlFor="file" style={{ cursor: 'pointer' }}>
        Import .md File
      </label>
      <input
        type="file"
        id="file"
        name="file"
        style={{ position: 'absolute', clip: 'rect(0 0 0 0)' }}
        onChange={onChange}
        accept=".md"
      />
    </div>
  );
}
`,paraId:20,tocIndex:2},{value:"\u5728\u8FD9\u6BB5\u4EE3\u7801\u4E2D\uFF0C\u6211\u4EEC\u5E76\u6CA1\u6709\u7528\u5230 ",paraId:21,tocIndex:2},{value:"<form>",paraId:21,tocIndex:2},{value:" \u6807\u7B7E\uFF0C\u800C\u662F\u76F4\u63A5\u76F4\u63A5\u76D1\u542C\u4E86 ",paraId:21,tocIndex:2},{value:'<input type="file">',paraId:21,tocIndex:2},{value:" \u7684 ",paraId:21,tocIndex:2},{value:"onChange",paraId:21,tocIndex:2},{value:" \u4E8B\u4EF6\u3002\u5F53\u89E6\u53D1 onChange \u4E8B\u4EF6\u7684\u65F6\u5019\uFF0C\u6211\u4EEC\u6784\u5EFA\u4E86\u4E00\u4E2A ",paraId:21,tocIndex:2},{value:"FormData",paraId:21,tocIndex:2},{value:" \u5BF9\u8C61\uFF0C\u5C06 ",paraId:21,tocIndex:2},{value:"File",paraId:21,tocIndex:2},{value:" \u5BF9\u8C61\u6DFB\u52A0\u8FDB\u53BB\u3002\u7136\u540E\u8C03\u7528 ",paraId:21,tocIndex:2},{value:"/api/upload",paraId:21,tocIndex:2},{value:"\u63A5\u53E3\uFF0C\u5C06 formData \u4F5C\u4E3A\u8BF7\u6C42\u4F53\u4F20\u5165\u3002\u5F53\u6570\u636E\u6210\u529F\u8FD4\u56DE\u65F6\uFF0C\u8DF3\u8F6C\u5230\u751F\u6210\u7684\u7B14\u8BB0\u5730\u5740\u3002",paraId:21,tocIndex:2},{value:"\u8FD9\u91CC\u7684\u8DF3\u8F6C\u6211\u4EEC\u7528\u7684\u662F ",paraId:22,tocIndex:2},{value:"useRouter",paraId:22,tocIndex:2},{value:"\u3002 ",paraId:22,tocIndex:2},{value:"redirect",paraId:22,tocIndex:2},{value:" \u53EA\u80FD\u7528\u5728\u670D\u52A1\u7AEF\u7EC4\u4EF6\u3001\u8DEF\u7531\u5904\u7406\u7A0B\u5E8F\u3001Server Actions\u3002\u5BA2\u6237\u7AEF\u624B\u52A8\u8DF3\u8F6C\u4F7F\u7528 ",paraId:22,tocIndex:2},{value:"useRouter",paraId:22,tocIndex:2},{value:"\u3002",paraId:22,tocIndex:2},{value:"\u65B0\u5EFA ",paraId:23,tocIndex:2},{value:"app/api/upload/route.js",paraId:23,tocIndex:2},{value:"\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:23,tocIndex:2},{value:`import { stat, mkdir, writeFile } from 'fs/promises';
import { join } from 'path';
import { NextResponse } from 'next/server';
import { revalidatePath } from 'next/cache';
import mime from 'mime';
import dayjs from 'dayjs';
import { addNote } from '@/lib/redis';

export async function POST(request) {
  // \u83B7\u53D6 formData
  const formData = await request.formData();
  const file = formData.get('file');

  // \u7A7A\u503C\u5224\u65AD
  if (!file) {
    return NextResponse.json({ error: 'File is required.' }, { status: 400 });
  }

  // \u5199\u5165\u6587\u4EF6
  const buffer = Buffer.from(await file.arrayBuffer());
  const relativeUploadDir = \`/uploads/\${dayjs().format('YY-MM-DD')}\`;
  const uploadDir = join(process.cwd(), 'public', relativeUploadDir);

  try {
    await stat(uploadDir);
  } catch (e) {
    if (e.code === 'ENOENT') {
      await mkdir(uploadDir, { recursive: true });
    } else {
      console.error(e);
      return NextResponse.json(
        { error: 'Something went wrong.' },
        { status: 500 },
      );
    }
  }

  try {
    // \u5199\u5165\u6587\u4EF6
    const uniqueSuffix = \`\${Math.random().toString(36).slice(-6)}\`;
    const filename = file.name.replace(/\\.[^/.]+$/, '');
    const uniqueFilename = \`\${filename}-\${uniqueSuffix}.\${mime.getExtension(
      file.type,
    )}\`;
    await writeFile(\`\${uploadDir}/\${uniqueFilename}\`, buffer);

    // \u8C03\u7528\u63A5\u53E3\uFF0C\u5199\u5165\u6570\u636E\u5E93
    const res = await addNote(
      JSON.stringify({
        title: filename,
        content: buffer.toString('utf-8'),
      }),
    );

    // \u6E05\u9664\u7F13\u5B58
    revalidatePath('/', 'layout');

    return NextResponse.json({
      fileUrl: \`\${relativeUploadDir}/\${uniqueFilename}\`,
      uid: res,
    });
  } catch (e) {
    console.error(e);
    return NextResponse.json(
      { error: 'Something went wrong.' },
      { status: 500 },
    );
  }
}
`,paraId:24,tocIndex:2},{value:"\u5728\u8FD9\u6BB5\u4EE3\u7801\u4E2D\uFF0C\u6211\u4EEC\u4F7F\u7528\u4E86 ",paraId:25,tocIndex:2},{value:"mime",paraId:25,tocIndex:2},{value:" \u8FD9\u4E2A\u5E93\uFF0C\u7528\u4E8E\u83B7\u53D6 MIME \u7C7B\u578B\u4FE1\u606F\u3002\u6240\u8C13 MIME (Multipurpose Internet Mail Extensions) \u662F\u63CF\u8FF0\u6D88\u606F\u5185\u5BB9\u7C7B\u578B\u7684\u6807\u51C6\uFF0C\u7528\u6765\u8868\u793A\u6587\u6863\u3001\u6587\u4EF6\u6216\u5B57\u8282\u6D41\u7684\u6027\u8D28\u548C\u683C\u5F0F\uFF0C\u4E5F\u5C31\u662F\u6211\u4EEC\u5E38\u89C1\u7684 ",paraId:25,tocIndex:2},{value:"text/plain",paraId:25,tocIndex:2},{value:"\u3001",paraId:25,tocIndex:2},{value:"image/jpeg",paraId:25,tocIndex:2},{value:"\u7B49\u3002\u5728\u8FD9\u91CC\u6211\u4EEC\u662F\u7528\u5B83\u83B7\u53D6\u6587\u4EF6\u6269\u5C55\u540D\u3002\u522B\u5FD8\u4E86\u5B89\u88C5\u8FD9\u4E2A\u5E93\uFF1A",paraId:25,tocIndex:2},{value:`npm i mime
`,paraId:26,tocIndex:2},{value:"\u6211\u4EEC\u901A\u8FC7 ",paraId:27,tocIndex:2},{value:"await request.formData()",paraId:27,tocIndex:2},{value:"\u83B7\u53D6\u4E86\u63D0\u4EA4\u7684 ",paraId:27,tocIndex:2},{value:"formData",paraId:27,tocIndex:2},{value:"\u3002\u83B7\u53D6\u5176\u4E2D\u7684 ",paraId:27,tocIndex:2},{value:"File",paraId:27,tocIndex:2},{value:" \u5BF9\u8C61\u540E\uFF0C\u6211\u4EEC\u4E3B\u8981\u505A\u4E86\u4E24\u4EF6\u4E8B\u60C5\uFF0C\u4E00\u662F\u5C06\u6587\u4EF6\u5199\u5165\u5230 ",paraId:27,tocIndex:2},{value:"public",paraId:27,tocIndex:2},{value:" \u76EE\u5F55\u4E0B\uFF0C\u4E8C\u662F\u6839\u636E\u6587\u4EF6\u4FE1\u606F\u521B\u5EFA\u4E86\u7B14\u8BB0\u3002\u6700\u7EC8\u63A5\u53E3\u8FD4\u56DE\u6587\u4EF6\u5730\u5740\u548C\u7B14\u8BB0 id\u3002",paraId:27,tocIndex:2},{value:"\u4E3A\u4E86\u65B9\u4FBF\u5199\u5165\uFF0C\u6211\u4EEC\u5C06\u5176\u8F6C\u4E3A Buffer \u5F62\u5F0F\uFF1A",paraId:28,tocIndex:2},{value:"Buffer.from(await file.arrayBuffer())",paraId:28,tocIndex:2},{value:"\uFF0C\u5E76\u901A\u8FC7 ",paraId:28,tocIndex:2},{value:"writeFile",paraId:28,tocIndex:2},{value:" \u5199\u5165\u6587\u4EF6\u3002\u4E3A\u4E86\u9632\u6B62\u6587\u4EF6\u91CD\u590D\uFF0C\u6211\u4EEC\u6839\u636E\u65E5\u671F\u521B\u5EFA\u6587\u4EF6\u5939\uFF0C\u5E76\u751F\u6210\u4E86\u968F\u673A\u5B57\u7B26\u6DFB\u52A0\u5230\u6587\u4EF6\u540D\u4E2D\u3002",paraId:28,tocIndex:2},{value:"\u7136\u540E\u6211\u4EEC\u901A\u8FC7 ",paraId:29,tocIndex:2},{value:"buffer.toString('utf-8')",paraId:29,tocIndex:2},{value:" \u83B7\u53D6\u4E86\u6587\u4EF6\u5185\u5BB9\uFF0C\u8C03\u7528\u4E4B\u524D ",paraId:29,tocIndex:2},{value:"redis.js",paraId:29,tocIndex:2},{value:" \u5BFC\u51FA\u7684 ",paraId:29,tocIndex:2},{value:"addNote",paraId:29,tocIndex:2},{value:" \u65B9\u6CD5\u6DFB\u52A0\u7B14\u8BB0\u5185\u5BB9\uFF0C\u7136\u540E\u6E05\u9664\u6570\u636E\u7F13\u5B58\uFF0C\u8FD4\u56DE\u4E86\u6587\u4EF6\u5730\u5740\u548C\u7B14\u8BB0 ID\u3002",paraId:29,tocIndex:2},{value:"\u73B0\u5728\u5E94\u8BE5\u53EF\u4EE5\u6B63\u5E38\u8FD0\u884C\u4E86\uFF1A",paraId:30,tocIndex:2},{value:"\u867D\u7136\u6587\u4EF6\u4E0A\u4F20\u6210\u529F\u4E86\uFF0C",paraId:31,tocIndex:2},{value:"public",paraId:31,tocIndex:2},{value:" \u76EE\u5F55\u4E0B\u4E5F\u53EF\u4EE5\u67E5\u770B\u5230\u8FD9\u4E2A\u6587\u4EF6\uFF0C\u7B14\u8BB0\u4E5F\u521B\u5EFA\u4E86\uFF0C\u4F46\u662F\u89C2\u5BDF\u5DE6\u4FA7\u7684\u7B14\u8BB0\u5217\u8868\uFF0C\u4F60\u4F1A\u53D1\u73B0\u867D\u7136\u9875\u9762\u8DF3\u8F6C\u5230\u5BF9\u5E94\u7684\u7B14\u8BB0\uFF0C\u4F46\u662F\u5DE6\u4FA7\u7684\u7B14\u8BB0\u5217\u8868\u5E76\u6CA1\u6709\u66F4\u65B0\uFF01",paraId:31,tocIndex:2},{value:"\u8FD9\u662F\u56E0\u4E3A\u867D\u7136\u6211\u4EEC\u5728\u63A5\u53E3\u4E2D\u4F7F\u7528\u4E86 ",paraId:32,tocIndex:2},{value:"revalidatePath",paraId:32,tocIndex:2},{value:"\uFF0C\u4F46\u662F\u5B83\u5E76\u4E0D\u80FD\u5F71\u54CD\u5BA2\u6237\u7AEF\u672C\u8EAB\u7684",paraId:32,tocIndex:2},{value:"\u8DEF\u7531\u7F13\u5B58",paraId:32,tocIndex:2},{value:"\u3002GitHub \u4E0A\u4E5F\u6709",paraId:32,tocIndex:2},{value:"\u8BA8\u8BBA",paraId:32,tocIndex:2},{value:"\u3002\u8FD8\u8BB0\u5F97\u600E\u4E48\u6E05\u9664\u8DEF\u7531\u7F13\u5B58\u5417\uFF1F",paraId:32,tocIndex:2},{value:"\u8FD9\u91CC\u5E76\u4E0D\u662F\u5728 Server Action \u4E2D\uFF0C\u6240\u4EE5\u53EA\u80FD\u4F7F\u7528\u7B2C\u4E8C\u79CD\u65B9\u5F0F\uFF0C\u6240\u4EE5\u6211\u4EEC\u5728 ",paraId:33,tocIndex:2},{value:"router.push",paraId:33,tocIndex:2},{value:"\u540E\u518D\u52A0\u4E00\u53E5\uFF1A",paraId:33,tocIndex:2},{value:"router.push(`/note/${data.uid}`);\nrouter.refresh();\n",paraId:34,tocIndex:2},{value:"\u5F53\u7136\u4E5F\u53EF\u4EE5\u914D\u5408 ",paraId:35,tocIndex:2},{value:"useTransition",paraId:35,tocIndex:2},{value:"\u4F7F\u7528\uFF1A",paraId:35,tocIndex:2},{value:`'use client'

import { useTransition } from 'react'

export default function SidebarImport() {
  const router = useRouter()
  const [isPending, startTransition] = useTransition();

  const onChange = async (e) => {
      // ...
      startTransition(() => router.push(\`/note/\${data.uid}\`));
      startTransition(() => router.refresh());
    	// ...
  };

  return (
    	// ...
  )
}
`,paraId:36,tocIndex:2},{value:"\u67E5\u770B ",paraId:37,tocIndex:2},{value:"/api/upload",paraId:37,tocIndex:2},{value:" \u63A5\u53E3\u7684\u8FD4\u56DE\uFF1A",paraId:37,tocIndex:2},{value:"\u56E0\u4E3A\u6211\u4EEC\u5C06\u6587\u4EF6\u653E\u5728\u4E86 ",paraId:38,tocIndex:2},{value:"public",paraId:38,tocIndex:2},{value:"\u4E0B\uFF0C\u6240\u4EE5\u76F4\u63A5\u8BBF\u95EE ",paraId:38,tocIndex:2},{value:"http://localhost:3000/uploads/24-01-03/occaecati-4s2adp.md",paraId:38,tocIndex:2},{value:"\u5373\u53EF\u67E5\u770B\u6587\u4EF6\u5185\u5BB9\uFF1A",paraId:38,tocIndex:2},{value:"\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF0C\u6211\u4EEC\u5E76\u6CA1\u6709\u7528\u5230\u8FD9\u4E2A URL\uFF0C\u5982\u679C\u5728\u5B9E\u9645\u7684\u5F00\u53D1\u4E2D\uFF0C\u4F60\u53EF\u4EE5\u7528\u8FD9\u4E2A URL \u5C55\u793A\u7F29\u7565\u56FE\u7B49\u3002",paraId:39,tocIndex:2},{value:"\u63A5\u4E0B\u6765\u6211\u4EEC\u7528 Server Actions \u91CD\u65B0\u5B9E\u73B0\u8FD9\u4E2A\u9700\u6C42\uFF0C\u5173\u4E8E\u6587\u4EF6\u4E0A\u4F20\uFF0C\u5B98\u65B9\u4E5F\u63D0\u4F9B\u4E86",paraId:40,tocIndex:3},{value:"\u793A\u4F8B\u4EE3\u7801 server-actions-upload",paraId:40,tocIndex:3},{value:" \u53EF\u4F9B\u53C2\u8003\u3002",paraId:40,tocIndex:3},{value:"\u4E00\u822C\u4F7F\u7528 Server Actions \u4F1A\u7528\u5728 ",paraId:41,tocIndex:3},{value:"<form>",paraId:41,tocIndex:3},{value:" \u6807\u7B7E\u7684 ",paraId:41,tocIndex:3},{value:"action",paraId:41,tocIndex:3},{value:" \u5C5E\u6027\u4E0A\uFF0C\u4F46\u8FD9\u6B21\u6211\u4EEC\u662F\u76D1\u542C ",paraId:41,tocIndex:3},{value:'<input type="file">',paraId:41,tocIndex:3},{value:" \u7684 ",paraId:41,tocIndex:3},{value:"onChange",paraId:41,tocIndex:3},{value:" \u4E8B\u4EF6\uFF0C\u6240\u4EE5\u6211\u4EEC\u5C31\u76F4\u63A5\u5728 ",paraId:41,tocIndex:3},{value:"onChange",paraId:41,tocIndex:3},{value:" \u4E8B\u4EF6\u4E2D\u8C03\u7528 Server Actions\uFF0C\u5BF9\u5E94\u8981\u4F7F\u7528\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u3002",paraId:41,tocIndex:3},{value:"\u5728 ",paraId:42,tocIndex:3},{value:"components/Sidebar.js",paraId:42,tocIndex:3},{value:"\u4E2D\u5BFC\u5165 ",paraId:42,tocIndex:3},{value:"<SidebarImport>",paraId:42,tocIndex:3},{value:" \u7EC4\u4EF6\uFF1A",paraId:42,tocIndex:3},{value:`// ...
import SidebarImport from '@/components/SidebarImport';

export default function Sidebar() {
  // ...
  return (
    <>
      <section className="col sidebar">
        // ...
        <nav>
          <Suspense fallback={<NoteListSkeleton />}>
            <SidebarNoteList />
          </Suspense>
        </nav>
        <SidebarImport />
      </section>
    </>
  );
}
`,paraId:43,tocIndex:3},{value:"\u65B0\u5EFA ",paraId:44,tocIndex:3},{value:"components/SidebarImport.js",paraId:44,tocIndex:3},{value:"\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:44,tocIndex:3},{value:`'use client';

import React from 'react';
import { useRouter } from 'next/navigation';
import { importNote } from '@/actions';

export default function SidebarImport() {
  const router = useRouter();

  const onChange = async (e) => {
    const fileInput = e.target;

    if (!fileInput.files || fileInput.files.length === 0) {
      console.warn('files list is empty');
      return;
    }

    const file = fileInput.files[0];

    const formData = new FormData();
    formData.append('file', file);

    try {
      const data = await importNote(formData);
      router.push(\`/note/\${data.uid}\`);
    } catch (error) {
      console.error('something went wrong');
    }

    // \u91CD\u7F6E file input
    e.target.type = 'text';
    e.target.type = 'file';
  };

  return (
    <div style={{ textAlign: 'center' }}>
      <label htmlFor="file" style={{ cursor: 'pointer' }}>
        Import .md File
      </label>
      <input
        type="file"
        id="file"
        name="file"
        style={{ position: 'absolute', clip: 'rect(0 0 0 0)' }}
        onChange={onChange}
        accept=".md"
      />
    </div>
  );
}
`,paraId:45,tocIndex:3},{value:"\u4E3A\u65B9\u4FBF\u5BFC\u5165\uFF0C\u66F4\u65B0 ",paraId:46,tocIndex:3},{value:"jsconfig.json",paraId:46,tocIndex:3},{value:"\uFF1A",paraId:46,tocIndex:3},{value:`{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/actions": ["app/actions.js"],
      "@/*": ["/*"]
    }
  }
}
`,paraId:47,tocIndex:3},{value:"\u5728 ",paraId:48,tocIndex:3},{value:"app/actions.js",paraId:48,tocIndex:3},{value:"\u6DFB\u52A0 ",paraId:48,tocIndex:3},{value:"importNote",paraId:48,tocIndex:3},{value:"\u65B9\u6CD5\uFF1A",paraId:48,tocIndex:3},{value:`'use server';

// ...
import { stat, mkdir, writeFile } from 'fs/promises';
import { join } from 'path';
import mime from 'mime';
import dayjs from 'dayjs';

// ...
export async function importNote(formData) {
  const file = formData.get('file');

  // \u7A7A\u503C\u5224\u65AD
  if (!file) {
    return { error: 'File is required.' };
  }

  // \u5199\u5165\u6587\u4EF6
  const buffer = Buffer.from(await file.arrayBuffer());
  const relativeUploadDir = \`/uploads/\${dayjs().format('YY-MM-DD')}\`;
  const uploadDir = join(process.cwd(), 'public', relativeUploadDir);

  try {
    await stat(uploadDir);
  } catch (e) {
    if (e.code === 'ENOENT') {
      await mkdir(uploadDir, { recursive: true });
    } else {
      console.error(e);
      return { error: 'Something went wrong.' };
    }
  }

  try {
    // \u5199\u5165\u6587\u4EF6
    const uniqueSuffix = \`\${Math.random().toString(36).slice(-6)}\`;
    const filename = file.name.replace(/\\.[^/.]+$/, '');
    const uniqueFilename = \`\${filename}-\${uniqueSuffix}.\${mime.getExtension(
      file.type,
    )}\`;
    await writeFile(\`\${uploadDir}/\${uniqueFilename}\`, buffer);

    // \u8C03\u7528\u63A5\u53E3\uFF0C\u5199\u5165\u6570\u636E\u5E93
    const res = await addNote(
      JSON.stringify({
        title: filename,
        content: buffer.toString('utf-8'),
      }),
    );

    // \u6E05\u9664\u7F13\u5B58
    revalidatePath('/', 'layout');

    return { fileUrl: \`\${relativeUploadDir}/\${uniqueFilename}\`, uid: res };
  } catch (e) {
    console.error(e);
    return { error: 'Something went wrong.' };
  }
}
`,paraId:49,tocIndex:3},{value:"\u6B64\u65F6\u9875\u9762\u8DDF\u7B2C\u4E00\u79CD\u65B9\u5F0F\u4E00\u6837\u6B63\u5E38\u8FD0\u884C\uFF1A",paraId:50,tocIndex:3},{value:"\u56E0\u4E3A\u5728 Server Actions \u4E2D\u8C03\u7528 revalidatePath \u4F1A\u6E05\u9664\u8DEF\u7531\u7F13\u5B58\uFF0C\u6240\u4EE5\u6211\u4EEC\u4E5F\u4E0D\u9700\u8981\u518D\u8C03\u7528 ",paraId:51,tocIndex:3},{value:"router.refresh()",paraId:51,tocIndex:3},{value:"\u3002",paraId:51,tocIndex:3},{value:"\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF0C\u6211\u4EEC\u662F\u5728 onChange \u4E8B\u4EF6\u4E2D\u8C03\u7528\u7684 Server Action\uFF0C\u4F7F\u7528\u8FD9\u79CD\u65B9\u5F0F\u5BF9\u5E94\u4F1A\u4E22\u5931\u6E10\u8FDB\u5F0F\u589E\u5F3A\uFF0C\u4E5F\u5C31\u662F\u8BF4\u5982\u679C\u7981\u7528 JS\uFF0C\u5C31\u65E0\u6CD5\u6B63\u5E38\u63D0\u4EA4\u4E86\u3002",paraId:52,tocIndex:3},{value:"\u5982\u679C\u6709\u63D0\u4EA4\u6309\u94AE\uFF0C\u5199\u6CD5\u4E0A\u4F1A\u7565\u6709\u6539\u53D8\uFF0C\u6211\u4EEC\u8BD5\u7740\u5199\u4E00\u4E0B\uFF1A",paraId:53,tocIndex:3},{value:"\u4FEE\u6539 ",paraId:54,tocIndex:3},{value:"components/SidebarImport.js",paraId:54,tocIndex:3},{value:"\uFF1A",paraId:54,tocIndex:3},{value:`'use client';

import { useRef } from 'react';
import { useFormStatus } from 'react-dom';
import { useRouter } from 'next/navigation';
import { importNote } from '@/actions';

function Submit() {
  const { pending } = useFormStatus();
  return (
    <button disabled={pending}>{pending ? 'Submitting' : 'Submit'}</button>
  );
}

export default function SidebarImport() {
  const router = useRouter();
  const formRef = useRef(null);

  async function upload(formData) {
    const file = formData.get('file');
    if (!file) {
      console.warn('files list is empty');
      return;
    }

    try {
      const data = await importNote(formData);
      router.push(\`/note/\${data.uid}\`);
    } catch (error) {
      console.error('something went wrong');
    }

    // \u91CD\u7F6E file input
    formRef.current?.reset();
  }

  return (
    <form style={{ textAlign: 'center' }} action={upload} ref={formRef}>
      <label htmlFor="file" style={{ cursor: 'pointer' }}>
        Import .md File
      </label>
      <input type="file" id="file" name="file" accept=".md" />
      <div>
        <Submit />
      </div>
    </form>
  );
}
`,paraId:55,tocIndex:3},{value:"actions.js",paraId:56,tocIndex:3},{value:"\u4E2D\u7684\u4EE3\u7801\u4E0D\u7528\u6539",paraId:56,tocIndex:3},{value:"\u90A3\u4E48\u4ECA\u5929\u7684\u5185\u5BB9\u5C31\u7ED3\u675F\u4E86\uFF0C\u672C\u7BC7\u4E3B\u8981\u662F\u56F4\u7ED5\u4E0A\u4F20\u6587\u4EF6\u529F\u80FD\uFF0C\u5E2E\u52A9\u5927\u5BB6\u719F\u6089\u5982\u4F55\u5904\u7406\u8868\u5355\u4E2D\u7684\u6587\u4EF6\u6570\u636E\u4EE5\u53CA\u5982\u4F55\u5199\u63A5\u53E3\uFF08route.js\uFF09\u548C Server Actions\uFF08actions.js\uFF09\u3002\u5728\u5B9E\u9645\u7684\u5F00\u53D1\u4E2D\uFF0C\u4E0A\u4F20\u6587\u4EF6\u5F80\u5F80\u4F1A\u66F4\u590D\u6742\uFF0C\u6BD4\u5982\u7F29\u7565\u56FE\u3001\u6587\u4EF6\u961F\u5217\u3001\u8FDB\u5EA6\u6761\u3001\u5927\u6587\u4EF6\u4E0A\u4F20\u7B49\uFF0C\u4F46\u4E5F\u8131\u79BB\u4E0D\u4E86\u8FD9\u4E24\u79CD\u6700\u57FA\u672C\u7684\u5F00\u53D1\u65B9\u5F0F\u3002",paraId:57,tocIndex:4},{value:"\u672C\u7BC7\u7684\u4EE3\u7801\u6211\u5DF2\u7ECF\u4E0A\u4F20\u5230",paraId:58,tocIndex:4},{value:"\u4EE3\u7801\u4ED3\u5E93",paraId:58,tocIndex:4},{value:"\u7684 Day 7 \u5206\u652F\uFF1A",paraId:58,tocIndex:4},{value:"\u7B2C\u4E00\u79CD\u65B9\u5F0F \u5728 ",paraId:59,tocIndex:4},{value:"day7",paraId:59,tocIndex:4},{value:" \u5206\u652F",paraId:59,tocIndex:4},{value:"\u7B2C\u4E8C\u79CD\u65B9\u5F0F \u5728 ",paraId:59,tocIndex:4},{value:"day7-1",paraId:59,tocIndex:4},{value:" \u5206\u652F",paraId:59,tocIndex:4},{value:"\u7B2C\u4E8C\u79CD\u65B9\u5F0F\u5E26\u63D0\u4EA4\u6309\u94AE \u5728 ",paraId:59,tocIndex:4},{value:"day7-2",paraId:59,tocIndex:4},{value:" \u5206\u652F",paraId:59,tocIndex:4},{value:"\u76F4\u63A5\u4F7F\u7528\u7684\u65F6\u5019\u4E0D\u8981\u5FD8\u8BB0\u5728\u672C\u5730\u5F00\u542F Redis\u3002",paraId:60,tocIndex:4},{value:"<input type=\u201Cfile\u201D> - HTML\uFF08\u8D85\u6587\u672C\u6807\u8BB0\u8BED\u8A00\uFF09 | MDN",paraId:61,tocIndex:5},{value:"HTMLFormElement: enctype property - Web APIs | MDN",paraId:61,tocIndex:5},{value:"https://developer.mozilla.org/zh-CN/docs/Web/API/File",paraId:61,tocIndex:5},{value:"Building a File Uploader from scratch with Next.js app directory",paraId:61,tocIndex:5},{value:"How to upload a file in Next.js 13+ App Directory with No libraries",paraId:61,tocIndex:5},{value:"Next.js V13: revalidate not triggering after router.push",paraId:61,tocIndex:5},{value:"https://github.com/vercel/next.js/discussions/54075",paraId:61,tocIndex:5}]},74785:function(r,l,a){r.exports=a.p+"static/image-108.96a36421.png"},17992:function(r,l,a){r.exports=a.p+"static/image-109.81635239.png"},98122:function(r,l,a){r.exports=a.p+"static/image-110.052f78f0.png"},93376:function(r,l,a){r.exports=a.p+"static/image-111.a4dc4824.png"},68400:function(r,l,a){r.exports=a.p+"static/image-112.b5d991d4.png"}}]);
