"use strict";(self.webpackChunkblog_cq=self.webpackChunkblog_cq||[]).push([[3899],{2393:function(o,s,t){t.r(s);var l=t(72269),u=t(93359),x=t(61788),p=t(19977),v=t(91558),a=t(24268),I=t(96057),m=t(85939),r=t(53683),d=t(80936),c=t(67294),n=t(81622),e=t(85893);function i(){return(0,e.jsx)(r.dY,{children:(0,e.jsx)(c.Suspense,{fallback:(0,e.jsx)(d.Z,{}),children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("h2",{id:"\u524D\u8A00",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u524D\u8A00",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u524D\u8A00"]}),(0,e.jsxs)("p",{children:[n.texts[0].value,(0,e.jsx)("a",{href:"https://juejin.cn/book/7307859898316881957/section/7309116644436115482",children:n.texts[1].value}),n.texts[2].value]}),(0,e.jsxs)("p",{children:[n.texts[3].value,(0,e.jsx)("a",{href:"https://juejin.cn/book/7307859898316881957/section/7309115864737611827#heading-7",children:n.texts[4].value}),n.texts[5].value]}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[6].value}),(0,e.jsxs)("h2",{id:"\u5B9E\u73B0\u601D\u8DEF",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u5B9E\u73B0\u601D\u8DEF",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u5B9E\u73B0\u601D\u8DEF"]}),(0,e.jsx)("p",{children:n.texts[7].value}),(0,e.jsxs)("p",{children:[n.texts[8].value,(0,e.jsx)("code",{children:n.texts[9].value}),n.texts[10].value]}),(0,e.jsxs)("div",{"data-client":"client","data-component":"Like",children:[n.texts[11].value,(0,e.jsx)("code",{children:n.texts[12].value}),n.texts[13].value,(0,e.jsx)("p",{}),(0,e.jsx)("p",{children:n.texts[14].value}),(0,e.jsxs)("h2",{id:"step1\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u7F16\u8BD1",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#step1\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u7F16\u8BD1",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Step1\uFF1A\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u7F16\u8BD1"]}),(0,e.jsxs)("p",{children:[n.texts[15].value,(0,e.jsx)("code",{children:n.texts[16].value}),n.texts[17].value]}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[18].value}),(0,e.jsxs)("p",{children:[n.texts[19].value,(0,e.jsx)("code",{children:n.texts[20].value}),n.texts[21].value,(0,e.jsx)("code",{children:n.texts[22].value}),n.texts[23].value,(0,e.jsx)("code",{children:n.texts[24].value}),n.texts[25].value]}),(0,e.jsxs)("p",{children:[n.texts[26].value,(0,e.jsx)("code",{children:n.texts[27].value}),n.texts[28].value,(0,e.jsx)("code",{children:n.texts[29].value}),n.texts[30].value,(0,e.jsx)("code",{children:n.texts[31].value}),n.texts[32].value]}),(0,e.jsx)("p",{children:n.texts[33].value}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[34].value}),(0,e.jsx)("p",{children:n.texts[35].value}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[36].value}),(0,e.jsx)("p",{children:n.texts[37].value}),(0,e.jsxs)("p",{children:[n.texts[38].value,(0,e.jsx)("code",{children:n.texts[39].value}),n.texts[40].value,(0,e.jsx)("code",{children:n.texts[41].value}),(0,e.jsx)("strong",{children:n.texts[42].value}),n.texts[43].value]}),(0,e.jsxs)("p",{children:[n.texts[44].value,(0,e.jsx)("code",{children:n.texts[45].value}),n.texts[46].value,(0,e.jsx)("code",{children:n.texts[47].value}),n.texts[48].value,(0,e.jsx)("code",{children:n.texts[49].value}),n.texts[50].value]}),(0,e.jsxs)("h2",{id:"step2\u6DFB\u52A0\u5BA2\u6237\u7AEF\u7EC4\u4EF6",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#step2\u6DFB\u52A0\u5BA2\u6237\u7AEF\u7EC4\u4EF6",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Step2\uFF1A\u6DFB\u52A0\u5BA2\u6237\u7AEF\u7EC4\u4EF6"]}),(0,e.jsx)("p",{children:n.texts[51].value}),(0,e.jsxs)("p",{children:[n.texts[52].value,(0,e.jsx)("code",{children:n.texts[53].value}),n.texts[54].value]}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[55].value}),(0,e.jsxs)("p",{children:[n.texts[56].value,(0,e.jsx)("code",{children:n.texts[57].value}),n.texts[58].value]}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[59].value}),(0,e.jsx)("p",{children:n.texts[60].value}),(0,e.jsxs)("p",{children:[n.texts[61].value,(0,e.jsx)("code",{children:n.texts[62].value}),n.texts[63].value]}),(0,e.jsxs)("h2",{id:"step3\u5BA2\u6237\u7AEF\u5904\u7406",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#step3\u5BA2\u6237\u7AEF\u5904\u7406",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"Step3\uFF1A\u5BA2\u6237\u7AEF\u5904\u7406"]}),(0,e.jsxs)("p",{children:[n.texts[64].value,(0,e.jsx)("code",{children:n.texts[65].value}),n.texts[66].value]}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[67].value}),(0,e.jsx)("p",{children:n.texts[68].value}),(0,e.jsxs)("p",{children:[n.texts[69].value,(0,e.jsx)("code",{children:n.texts[70].value}),n.texts[71].value]}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[72].value}),(0,e.jsxs)("p",{children:[n.texts[73].value,(0,e.jsx)("code",{children:n.texts[74].value}),n.texts[75].value,(0,e.jsx)("code",{children:n.texts[76].value}),n.texts[77].value,(0,e.jsx)("code",{children:n.texts[78].value}),n.texts[79].value]}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d2df536a5de2415693878dd1f9cd12c5~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1113&h=701&s=116800&e=gif&f=35&b=252728",alt:"react-rsc-18.gif"})}),(0,e.jsx)("p",{children:n.texts[80].value}),(0,e.jsx)("blockquote",{children:(0,e.jsxs)("ol",{children:[(0,e.jsx)("li",{children:n.texts[81].value}),(0,e.jsxs)("li",{children:[n.texts[82].value,(0,e.jsx)("a",{href:"https://github.com/mqyqingfeng/next-app-demo/tree/react-rsc-12",children:n.texts[83].value})]}),(0,e.jsxs)("li",{children:[n.texts[84].value,(0,e.jsx)("code",{children:n.texts[85].value})]})]})}),(0,e.jsxs)("h2",{id:"\u603B\u7ED3",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u603B\u7ED3",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u603B\u7ED3"]}),(0,e.jsx)("p",{children:n.texts[86].value}),(0,e.jsxs)("p",{children:[n.texts[87].value,(0,e.jsx)("code",{children:n.texts[88].value}),n.texts[89].value]}),(0,e.jsx)("p",{children:n.texts[90].value}),(0,e.jsx)("p",{children:n.texts[91].value})]})]})})})})}s.default=i},81622:function(o,s,t){t.r(s),t.d(s,{texts:function(){return l}});const l=[{value:"\u672C\u6765\u6211\u60F3\u5728 ",paraId:0,tocIndex:0},{value:"\u300A\u6E90\u7801\u7BC7 | \u5B9E\u73B0 Server Actions\u300B",paraId:0,tocIndex:0},{value:"\u7684\u57FA\u7840\u4E0A\uFF0C\u5B8C\u6574\u5B9E\u73B0\u5BA2\u6237\u7AEF\u7EC4\u4EF6\uFF0C\u4F46\u5948\u4F55\u5B9E\u73B0\u4E4B\u8DEF\u592A\u8FC7\u574E\u5777\uFF0C\u9047\u5230\u592A\u591A\u83AB\u540D\u5947\u5999\u7684\u95EE\u9898\uFF0C\u6240\u4EE5\u672C\u7BC7\u53EA\u80FD\u6D45\u6D45\u5B9E\u73B0\u4E00\u4E0B\uFF0C\u5C3D\u7BA1\u5982\u6B64\uFF0C\u5374\u4E5F\u80FD\u5E2E\u52A9\u5927\u5BB6\u7406\u89E3\u5176\u80CC\u540E\u5B9E\u73B0\u3002",paraId:0,tocIndex:0},{value:"\u73B0\u5728\u5C31\u8BA9\u6211\u4EEC\u5F00\u59CB\u5427\u3002\u8FD9\u6B21\u6211\u4EEC\u57FA\u4E8E\u7684\u662F",paraId:1,tocIndex:0},{value:"\u300A\u6E90\u7801\u7BC7 | RSC \u5B9E\u73B0\u539F\u7406\u300B",paraId:1,tocIndex:0},{value:"\u7684\u5B9E\u73B0\uFF0C\u6B64\u65F6\u521A\u5B9E\u73B0 RSC Server \u548C SSR Server \u7684\u62C6\u5206\u3002\u5982\u679C\u6CA1\u6709\u5B9E\u73B0\u4E4B\u524D\u7684\u4EE3\u7801\uFF0C\u53EF\u4EE5\u8FD0\u884C\uFF1A",paraId:1,tocIndex:0},{value:`# \u4E0B\u8F7D\u6307\u5B9A\u5206\u652F\u7684\u4EE3\u7801
git clone -b react-rsc-9 git@github.com:mqyqingfeng/next-app-demo.git
# \u8FDB\u5165\u76EE\u5F55\u5E76\u5B89\u88C5\u4F9D\u8D56\u9879
cd next-app-demo && npm i
# \u542F\u52A8
npm start
`,paraId:2,tocIndex:0},{value:"\u8BE5\u600E\u4E48\u5B9E\u73B0\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u5462\uFF1F\u5176\u5B9E\u5B9E\u73B0\u601D\u8DEF\u662F\u6BD4\u8F83\u7B80\u5355\u7684\uFF1A",paraId:3,tocIndex:1},{value:"\u7F16\u8BD1\u4EE3\u7801\u7684\u65F6\u5019\uFF0C\u5982\u679C\u9047\u5230\u4EE5 ",paraId:4,tocIndex:1},{value:"'use client'",paraId:4,tocIndex:1},{value:"\u4E3A\u5F00\u5934\u7684\u7EC4\u4EF6\uFF0C\u8BF4\u660E\u662F\u5BA2\u6237\u7AEF\u7EC4\u4EF6\uFF0C\u4F7F\u7528\u7279\u6B8A\u7684\u5360\u4F4D\u7B26\u66FF\u4EE3\u3002\u6BD4\u5982\u4EE5\u76EE\u524D\u7684 JSX \u5BF9\u8C61\u5B9E\u73B0\u65B9\u5F0F\u4E3A\u4F8B\u7684\u8BDD\uFF0C\u53EF\u4EE5\u66FF\u6362\u4E3A ",paraId:4,tocIndex:1},{value:" \u8FD9\u6837\u7684\u8282\u70B9\u3002\u8868\u660E\u8BE5\u4F4D\u7F6E\u662F\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u5360\u4F4D\uFF0C\u6307\u5411\u7684\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u662F ",paraId:5},{value:"<Like>",paraId:5},{value:"\u3002",paraId:5},{value:"\u7136\u540E\u5C06\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u7F16\u8BD1\u4E3A\u5355\u72EC\u7684 JS \u4EE3\u7801\u3002\u5728\u5BA2\u6237\u7AEF\u52A0\u8F7D\u7684\u65F6\u5019\uFF0C\u904D\u5386\u6240\u6709\u7684\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u5360\u4F4D\uFF0C\u52A0\u8F7D\u5BF9\u5E94\u7684 JS \u4EE3\u7801\uFF0C\u4E3A\u6BCF\u4E2A\u7EC4\u4EF6\u5355\u72EC\u8FDB\u884C\u6E32\u67D3\u6C34\u5408\u3002",paraId:6,tocIndex:1},{value:"\u4FEE\u6539 ",paraId:7,tocIndex:2},{value:"client.js",paraId:7,tocIndex:2},{value:"\uFF0C\u6DFB\u52A0\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:7,tocIndex:2},{value:`import React from 'react';
import { readFile, writeFile } from 'fs/promises';
import path from 'path';

export async function renderJSXToClientJSX(jsx) {
  if (
    typeof jsx === 'string' ||
    typeof jsx === 'number' ||
    typeof jsx === 'boolean' ||
    jsx == null
  ) {
    return jsx;
  } else if (Array.isArray(jsx)) {
    return Promise.all(jsx.map((child) => renderJSXToClientJSX(child)));
  } else if (jsx != null && typeof jsx === 'object') {
    if (jsx.$$typeof === Symbol.for('react.element')) {
      if (typeof jsx.type === 'string') {
        return {
          ...jsx,
          props: await renderJSXToClientJSX(jsx.props),
        };
      } else if (typeof jsx.type === 'function') {
        const Component = jsx.type;
        const props = jsx.props;
        const isClientComponent = Component.toString().includes('use client');
        if (isClientComponent) {
          return await transformClientComponent(Component, props);
        } else {
          const returnedJsx = await Component(props);
          return renderJSXToClientJSX(returnedJsx);
        }
      } else throw new Error('Not implemented.');
    } else {
      return Object.fromEntries(
        await Promise.all(
          Object.entries(jsx).map(async ([propName, value]) => [
            propName,
            await renderJSXToClientJSX(value),
          ]),
        ),
      );
    }
  } else throw new Error('Not implemented');
}

async function transformClientComponent(Component, props) {
  const raw = Component.toString();
  const children = await renderJSXToClientJSX(props.children);

  const clientComponent = {
    value: raw,
    props: {
      ...props,
      'data-client': true,
      'data-component': Component.name,
      children,
    },
  };

  await createClientComponentJS(clientComponent);

  return React.createElement('div', {
    'data-client': true,
    'data-component': Component.name,
  });
}

async function createClientComponentJS(Component) {
  const { props, value } = Component;
  const name = props['data-component'];
  const filenameRaw = path.join(
    process.cwd(),
    'public',
    'client',
    name + '.js',
  );
  const filename = path.normalize(filenameRaw);
  const fileContents = \`import React from "react"
      export const props = \${JSON.stringify(props)}
      export const jsx = \${value.replaceAll('import_react.default', 'React')}\`;
  try {
    await writeFile(filename, fileContents);
  } catch (err) {
    console.log('error in writeComponentToDisk', err);
  }
}
`,paraId:8,tocIndex:2},{value:"\u5728\u8FD9\u6BB5\u4EE3\u7801\u4E2D\uFF0C\u6211\u4EEC\u4FEE\u6539\u4E86 ",paraId:9,tocIndex:2},{value:"renderJSXToClientJSX",paraId:9,tocIndex:2},{value:"\u51FD\u6570\uFF0C\u5F53\u51FD\u6570\u7EC4\u4EF6\u4EE3\u7801\u5305\u542B ",paraId:9,tocIndex:2},{value:'"use client"',paraId:9,tocIndex:2},{value:" \u65F6\uFF0C\u89C6\u4E3A\u5BA2\u6237\u7AEF\u7EC4\u4EF6\uFF0C\u8C03\u7528 ",paraId:9,tocIndex:2},{value:"transformClientComponent",paraId:9,tocIndex:2},{value:" \u51FD\u6570\u8FDB\u884C\u5904\u7406",paraId:9,tocIndex:2},{value:"\u5728 ",paraId:10,tocIndex:2},{value:"transformClientComponent",paraId:10,tocIndex:2},{value:" \u4E2D\uFF0C\u6211\u4EEC\u9996\u5148\u4F1A\u6784\u5EFA\u4E00\u4E2A\u540D\u4E3A ",paraId:10,tocIndex:2},{value:"clientComponent",paraId:10,tocIndex:2},{value:" \u7684\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u5BF9\u8C61\uFF0C\u7136\u540E\u5C06\u5176\u4F20\u7ED9 ",paraId:10,tocIndex:2},{value:"createClientComponentJS",paraId:10,tocIndex:2},{value:" \u51FD\u6570\u7528\u4E8E\u751F\u6210\u5BF9\u5E94\u7684\u5BA2\u6237\u7AEF JS\u3002",paraId:10,tocIndex:2},{value:"\u4EE5\u8FD9\u6837\u4E00\u6BB5\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u4EE3\u7801\u4E3A\u4F8B\u7684\u8BDD\uFF1A",paraId:11,tocIndex:2},{value:`'use client';

import React from 'react';
function Like() {
  const [likes, setLikes] = React.useState(100);
  return (
    <button
      onClick={() => {
        setLikes(likes + 1);
      }}
    >
      \u2764\uFE0F {likes}
    </button>
  );
}
export default Like;
`,paraId:12,tocIndex:2},{value:"\u6700\u7EC8\u751F\u6210\u7684 JS \u4EE3\u7801\u5927\u81F4\u5982\u4E0B\uFF1A",paraId:13,tocIndex:2},{value:`import React from 'react';
export const props = { 'data-client': true, 'data-component': 'Like' };
export const jsx = function Like() {
  const [likes, setLikes] = React.useState(100);
  return React.createElement(
    'button',
    {
      onClick: () => {
        setLikes(likes + 1);
      },
    },
    '\\u2764\\uFE0F ',
    likes,
  );
};
`,paraId:14,tocIndex:2},{value:"\u5176\u4E2D jsx \u5BF9\u5E94\u7EC4\u4EF6\u7684\u4EE3\u7801\uFF0Cprops \u5BF9\u5E94\u7EC4\u4EF6\u7684 props\u3002",paraId:15,tocIndex:2},{value:"\u56E0\u4E3A\u6211\u4EEC\u5C06\u7F16\u8BD1\u7684 JS \u4EE3\u7801\u653E\u5728\u4E86 ",paraId:16,tocIndex:2},{value:"public/client",paraId:16,tocIndex:2},{value:"\u76EE\u5F55\u4E0B\uFF0C**\u6240\u4EE5\u522B\u5FD8\u4E86\u65B0\u5EFA **",paraId:16,tocIndex:2},{value:"**public/client**",paraId:16,tocIndex:2},{value:"\u76EE\u5F55",paraId:16,tocIndex:2},{value:"\u3002",paraId:16,tocIndex:2},{value:"\u5728 ",paraId:17,tocIndex:2},{value:"transformClientComponent",paraId:17,tocIndex:2},{value:" \u4E2D\uFF0C\u6700\u540E\u6211\u4EEC\u4F1A\u8FD4\u56DE\u4E00\u4E2A ",paraId:17,tocIndex:2},{value:'React.createElement( "div", { "data-client": true, "data-component": Component.name})',paraId:17,tocIndex:2},{value:"\u7684 JSX \u5BF9\u8C61\uFF0C\u5B83\u4F1A\u88AB\u6E32\u67D3\u4E3A ",paraId:17,tocIndex:2},{value:'<div data-client="client" data-component="Like">',paraId:17,tocIndex:2},{value:"\uFF0C\u7528\u4E8E\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u5360\u4F4D\u3002",paraId:17,tocIndex:2},{value:"\u73B0\u5728\u8BA9\u6211\u4EEC\u6DFB\u52A0\u4E00\u4E2A\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u8BD5\u8BD5\u5427\u3002",paraId:18,tocIndex:3},{value:"\u4FEE\u6539 ",paraId:19,tocIndex:3},{value:"components.tsx",paraId:19,tocIndex:3},{value:"\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:19,tocIndex:3},{value:`import Like from './Like';

async function Post({ slug }) {
  let content = await readFile('./posts/' + slug + '.txt', 'utf8');
  return (
    <section>
      <a className="text-blue-600" href={'/' + slug}>
        {slug}
      </a>
      <article className="h-40 mt-5 flex-1 rounded-xl bg-indigo-500 text-white flex items-center justify-center">
        {content}
      </article>
      <Like />
    </section>
  );
}
`,paraId:20,tocIndex:3},{value:"\u65B0\u5EFA ",paraId:21,tocIndex:3},{value:"Like.tsx",paraId:21,tocIndex:3},{value:"\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:21,tocIndex:3},{value:`import React from 'react';

function Like() {
  'use client';

  const [likes, setLikes] = React.useState(100);

  return (
    <button
      onClick={() => {
        setLikes(likes + 1);
      }}
    >
      \u2764\uFE0F {likes}
    </button>
  );
}

export default Like;
`,paraId:22,tocIndex:3},{value:"\u4EE3\u7801\u770B\u8D77\u6765\u6709\u4E9B\u5947\u602A\uFF0C\u5176\u5B9E\u4E5F\u662F\u8FEB\u4E0D\u5F97\u5DF2\u624D\u8FD9\u6837\u5199\u7684\u3002",paraId:23,tocIndex:3},{value:"\u56E0\u4E3A\u6211\u4EEC\u7528\u7684\u662F tsx \u8FDB\u884C\u7684\u7F16\u8BD1\uFF0C\u5F53\u8C03\u7528 renderJSXToClientJSX \u7684\u65F6\u5019\uFF0C\u83B7\u53D6\u4E0D\u5230\u9876\u90E8\u7684 ",paraId:24,tocIndex:3},{value:"use client",paraId:24,tocIndex:3},{value:"\u6307\u4EE4\uFF0C\u6240\u4EE5\u4E3A\u4E86\u533A\u5206\u5BA2\u6237\u7AEF\u7EC4\u4EF6\uFF0C\u6211\u4EEC\u5C31\u201C\u59D4\u66F2\u6C42\u5168\u201D\u7684\u5199\u5728\u4E86\u7EC4\u4EF6\u5185\u90E8\u3002",paraId:24,tocIndex:3},{value:"\u4FEE\u6539 ",paraId:25,tocIndex:4},{value:"client.js",paraId:25,tocIndex:4},{value:"\uFF0C\u6DFB\u52A0\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:25,tocIndex:4},{value:`import React from 'react';
import { hydrateRoot, createRoot } from 'react-dom/client';

const clientComponents = document.querySelectorAll('[data-client=true]');

for (const clientComponent of clientComponents) {
  const componentName = clientComponent.getAttribute('data-component');
  const ClientComponent = await import('./client/' + \`\${componentName}.js\`);
  const { jsx, props } = ClientComponent;

  const clientComponentJSX = React.createElement(jsx, props);
  clientComponent.setAttribute('data-loading', false);

  const clientComponentRoot = createRoot(clientComponent);
  clientComponentRoot.render(clientComponentJSX);
}
`,paraId:26,tocIndex:4},{value:"\u5B9E\u73B0\u7684\u6548\u679C\u5C31\u662F\u904D\u5386\u6240\u6709\u7684\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u5360\u4F4D\uFF0C\u6839\u636E\u5176 data-component \u5C5E\u6027\uFF0C\u52A0\u8F7D\u5BF9\u5E94\u7684 JS \u6587\u4EF6\uFF0C\u7136\u540E\u5728\u5BA2\u6237\u7AEF\u8FDB\u884C\u6E32\u67D3\u6C34\u5408\u3002",paraId:27,tocIndex:4},{value:"\u4FEE\u6539 ",paraId:28,tocIndex:4},{value:"server/ssr.ts",paraId:28,tocIndex:4},{value:"\uFF0C\u5C06 publick \u8BBE\u4E3A\u9759\u6001\u76EE\u5F55\uFF0C\u987A\u4FBF\u4FEE\u6B63 2 \u5904\u7EC6\u8282\u95EE\u9898\uFF1A",paraId:28,tocIndex:4},{value:`// 1. \u6DFB\u52A0 public \u9759\u6001\u76EE\u5F55
app.use(express.static('public'))

app.get("/:route(*)", async (req, res) => {

  // 2. \u5904\u7406 favicon.ico \u6587\u4EF6\uFF0C\u9632\u6B62\u62A5\u9519
  if (url.pathname === '/favicon.ico') {
    return
  }

  // 3. \u62FC\u63A5 HTML \u8FD9\u91CC\u4FEE\u6539\u4E86 react \u5BFC\u5165\u7684\u5730\u5740\uFF0C\u52A0\u4E86\u4E00\u4E2A dev \u53C2\u6570
    html += \`
      <script type="importmap">
        {
          "imports": {
            "react": "https://esm.sh/react@18.2.0?dev",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client?dev"
          }
        }
      <\/script>
      <script type="module" src="/client.js"><\/script>
    \`;
  }
});
`,paraId:29,tocIndex:4},{value:"\u6B64\u65F6\u8FD0\u884C ",paraId:30,tocIndex:4},{value:"npm start",paraId:30,tocIndex:4},{value:"\uFF0C\u5237\u65B0\u9875\u9762\uFF0C",paraId:30,tocIndex:4},{value:"public/client",paraId:30,tocIndex:4},{value:"\u4E0B\u4F1A\u5BFC\u51FA ",paraId:30,tocIndex:4},{value:"Like.js",paraId:30,tocIndex:4},{value:"\uFF0C\u6D4F\u89C8\u5668\u4EA4\u4E92\u6548\u679C\u5982\u4E0B\uFF1A",paraId:30,tocIndex:4},{value:"\u6B64\u65F6\u6211\u4EEC\u5C31\u5B9E\u73B0\u4E86\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u3002",paraId:31,tocIndex:4},{value:"\u529F\u80FD\u5B9E\u73B0\uFF1A\u5BA2\u6237\u7AEF\u7EC4\u4EF6",paraId:32,tocIndex:4},{value:"\u6E90\u7801\u5730\u5740\uFF1A",paraId:32,tocIndex:4},{value:"https://github.com/mqyqingfeng/next-app-demo/tree/react-rsc-12",paraId:32,tocIndex:4},{value:"\u4E0B\u8F7D\u4EE3\u7801\uFF1A",paraId:32,tocIndex:4},{value:"git clone -b react-rsc-12 git@github.com:mqyqingfeng/next-app-demo.git",paraId:32,tocIndex:4},{value:"\u5176\u5B9E\u6211\u4EEC\u5B9E\u73B0\u7684\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u975E\u5E38\u201C\u8106\u5F31\u201D\uFF0C\u9875\u9762\u5237\u65B0\u7684\u65F6\u5019\u4F1A\u6709\uFF0C\u5BFC\u822A\u7684\u65F6\u5019\u5C31\u6CA1\u6709\u4E86\u2026\u2026\u6240\u4EE5\u8FD8\u6709\u5F88\u591A\u8981\u5904\u7406\u7684\u5730\u65B9\uFF0C\u4F46\u4E2A\u4EBA\u80FD\u529B\u6709\u9650\uFF0C\u53EA\u80FD\u501F\u8FD9\u4E2A\u7B80\u5355\u7684\u5B9E\u73B0\u5E2E\u52A9\u5927\u5BB6\u7406\u89E3\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u7684\u5B9E\u73B0\u3002",paraId:33,tocIndex:5},{value:"\u5728 Next.js \u4E2D\u7684\u5B9E\u73B0\uFF0C\u5BA2\u6237\u7AEF\u7EC4\u4EF6\u5176\u5B9E\u662F\u4F1A\u88AB\u9884\u6E32\u67D3\u7684\uFF0C\u800C\u6211\u4EEC\u662F\u76F4\u63A5\u66FF\u6362\u4E3A\u4E00\u4E2A ",paraId:34,tocIndex:5},{value:'<div data-client="client" data-component="Like">',paraId:34,tocIndex:5},{value:"DOM \u8282\u70B9\u3002\u56E0\u4E3A DOM \u8282\u70B9\u65E0\u5185\u5BB9\uFF0C\u6240\u4EE5\u6211\u4EEC\u76F4\u63A5\u7528\u4E86 createRoot\uFF0C\u66F4\u8D34\u5408\u7684\u5B9E\u73B0\u5E94\u8BE5\u7528 hyrateRoot\u3002",paraId:34,tocIndex:5},{value:"\u6B64\u5916\uFF0CNext.js \u662F\u5728 RSC Payload \u4E2D\u663E\u793A\u8981\u52A0\u8F7D\u7684\u5BA2\u6237\u7AEF JS\uFF0C\u5BA2\u6237\u7AEF\u6536\u5230 RSC Payload \u540E\uFF0C\u52A0\u8F7D\u5BF9\u5E94\u7684 JS \u4EE3\u7801\u518D\u8FDB\u884C\u6C34\u5408\uFF0C\u800C\u6211\u4EEC\u662F\u7B80\u5355\u7C97\u66B4\u7684\u904D\u5386\u8282\u70B9\u52A0\u8F7D\u5BF9\u5E94\u7684 JS\u3002",paraId:35,tocIndex:5},{value:"Next.js \u7684\u5BA2\u6237\u7AEF\u7EC4\u4EF6\uFF0C\u4F60\u53EF\u4EE5\u7B80\u5355\u7C97\u66B4\u7684\u7406\u89E3\u4E3A\u201CSSR + \u6C34\u5408 + CSR\u201D\uFF0C\u5728\u670D\u52A1\u7AEF\u8FDB\u884C\u9884\u6E32\u67D3\u5373 SSR\uFF0C\u5728\u5BA2\u6237\u7AEF\u8FDB\u884C\u6C34\u5408\uFF0C\u6DFB\u52A0\u4E8B\u4EF6\uFF0C\u6700\u540E\u5728\u5BA2\u6237\u7AEF\u8FDB\u884C\u66F4\u65B0\u5373 CSR\u3002",paraId:36,tocIndex:5}]}}]);
