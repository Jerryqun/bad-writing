"use strict";(self.webpackChunkblog_cq=self.webpackChunkblog_cq||[]).push([[1347],{66553:function(o,s,t){t.r(s);var r=t(72269),u=t(93359),x=t(61788),p=t(19977),m=t(91558),a=t(24268),h=t(96057),v=t(85939),i=t(53683),d=t(80936),l=t(67294),n=t(16485),e=t(85893);function c(){return(0,e.jsx)(i.dY,{children:(0,e.jsx)(l.Suspense,{fallback:(0,e.jsx)(d.Z,{}),children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"markdown",children:[(0,e.jsxs)("h2",{id:"\u524D\u8A00",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u524D\u8A00",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u524D\u8A00"]}),(0,e.jsx)("p",{children:n.texts[0].value}),(0,e.jsxs)("h2",{id:"1-\u529F\u80FD\u521B\u5EFA\u4EFB\u52A1",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#1-\u529F\u80FD\u521B\u5EFA\u4EFB\u52A1",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"1. \u529F\u80FD\uFF1A\u521B\u5EFA\u4EFB\u52A1"]}),(0,e.jsxs)("h3",{id:"11-\u6570\u636E\u5E93-schema-\u5B9A\u4E49",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#11-\u6570\u636E\u5E93-schema-\u5B9A\u4E49",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"1.1. \u6570\u636E\u5E93 Schema \u5B9A\u4E49"]}),(0,e.jsxs)("p",{children:[n.texts[1].value,(0,e.jsx)("code",{children:n.texts[2].value}),n.texts[3].value]}),(0,e.jsx)(a.Z,{children:n.texts[4].value}),(0,e.jsx)("p",{children:n.texts[5].value}),(0,e.jsx)(a.Z,{lang:"bash",children:n.texts[6].value}),(0,e.jsxs)("h3",{id:"12-\u8868\u5355\u4E0E\u524D\u7AEF\u6570\u636E\u6821\u9A8C",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#12-\u8868\u5355\u4E0E\u524D\u7AEF\u6570\u636E\u6821\u9A8C",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"1.2. \u8868\u5355\u4E0E\u524D\u7AEF\u6570\u636E\u6821\u9A8C"]}),(0,e.jsxs)("p",{children:[n.texts[7].value,(0,e.jsx)("code",{children:n.texts[8].value}),n.texts[9].value]}),(0,e.jsx)(a.Z,{lang:"diff",children:n.texts[10].value}),(0,e.jsxs)("p",{children:[n.texts[11].value,(0,e.jsx)("code",{children:n.texts[12].value}),n.texts[13].value]}),(0,e.jsxs)("p",{children:[n.texts[14].value,(0,e.jsx)("code",{children:n.texts[15].value}),n.texts[16].value]}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[17].value}),(0,e.jsxs)("p",{children:[n.texts[18].value,(0,e.jsx)("code",{children:n.texts[19].value}),n.texts[20].value]}),(0,e.jsxs)("p",{children:[n.texts[21].value,(0,e.jsx)("code",{children:n.texts[22].value}),n.texts[23].value]}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[24].value}),(0,e.jsxs)("p",{children:[n.texts[25].value,(0,e.jsx)("code",{children:n.texts[26].value}),n.texts[27].value]}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[28].value}),(0,e.jsx)("p",{children:n.texts[29].value}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/40f8de8fd51b49e49c20c4eb4978db60~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1023&h=641&s=246755&e=gif&f=48&b=2b2b2b",alt:"t3-15.gif"})}),(0,e.jsx)("p",{children:n.texts[30].value}),(0,e.jsxs)("h3",{id:"13-\u6DFB\u52A0\u670D\u52A1\u7AEF\u903B\u8F91",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#13-\u6DFB\u52A0\u670D\u52A1\u7AEF\u903B\u8F91",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"1.3. \u6DFB\u52A0\u670D\u52A1\u7AEF\u903B\u8F91"]}),(0,e.jsxs)("p",{children:[n.texts[31].value,(0,e.jsx)("code",{children:n.texts[32].value}),n.texts[33].value]}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[34].value}),(0,e.jsxs)("p",{children:[n.texts[35].value,(0,e.jsx)("code",{children:n.texts[36].value}),n.texts[37].value]}),(0,e.jsx)(a.Z,{lang:"diff",children:n.texts[38].value}),(0,e.jsx)("p",{children:n.texts[39].value}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d3a52dad5e8e4af891931cbcd02b4ac3~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=880&h=639&s=323686&e=gif&f=84&b=fefefe",alt:"t3-16.gif"})}),(0,e.jsx)("p",{children:n.texts[40].value}),(0,e.jsxs)("h2",{id:"2-\u529F\u80FD\u5C55\u793A\u4EFB\u52A1",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#2-\u529F\u80FD\u5C55\u793A\u4EFB\u52A1",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"2. \u529F\u80FD\uFF1A\u5C55\u793A\u4EFB\u52A1"]}),(0,e.jsxs)("p",{children:[n.texts[41].value,(0,e.jsx)("code",{children:n.texts[42].value}),n.texts[43].value]}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[44].value}),(0,e.jsxs)("p",{children:[n.texts[45].value,(0,e.jsx)("code",{children:n.texts[46].value}),n.texts[47].value]}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[48].value}),(0,e.jsx)("p",{children:n.texts[49].value}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0208b8af553443a589fd4fac57053bb2~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=880&h=639&s=191579&e=gif&f=50&b=fefefe",alt:"t3-17.gif"})}),(0,e.jsxs)("h2",{id:"3-\u529F\u80FD\u5B8C\u6210\u4EFB\u52A1",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#3-\u529F\u80FD\u5B8C\u6210\u4EFB\u52A1",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"3. \u529F\u80FD\uFF1A\u5B8C\u6210\u4EFB\u52A1"]}),(0,e.jsxs)("p",{children:[n.texts[50].value,(0,e.jsx)("code",{children:n.texts[51].value}),n.texts[52].value]}),(0,e.jsx)(a.Z,{lang:"typescript",children:n.texts[53].value}),(0,e.jsxs)("p",{children:[n.texts[54].value,(0,e.jsx)("code",{children:n.texts[55].value}),n.texts[56].value]}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[57].value}),(0,e.jsx)("p",{children:n.texts[58].value}),(0,e.jsx)("p",{children:(0,e.jsx)("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/435a62129996429c9f188e61d77b29f2~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=877&h=656&s=41843&e=gif&f=26&b=e14f62",alt:"t3-18.gif"})}),(0,e.jsxs)("h2",{id:"4-\u4FEE\u590D\u6784\u5EFA\u9519\u8BEF",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#4-\u4FEE\u590D\u6784\u5EFA\u9519\u8BEF",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"4. \u4FEE\u590D\uFF1A\u6784\u5EFA\u9519\u8BEF"]}),(0,e.jsx)("p",{children:n.texts[59].value}),(0,e.jsx)(a.Z,{lang:"bash",children:n.texts[60].value}),(0,e.jsx)("p",{children:n.texts[61].value}),(0,e.jsx)("p",{children:n.texts[62].value}),(0,e.jsxs)("ol",{children:[(0,e.jsxs)("li",{children:[n.texts[63].value,(0,e.jsx)("code",{children:n.texts[64].value}),n.texts[65].value,(0,e.jsx)("code",{children:n.texts[66].value}),n.texts[67].value]}),(0,e.jsxs)("li",{children:[n.texts[68].value,(0,e.jsx)("code",{children:n.texts[69].value}),n.texts[70].value]})]}),(0,e.jsx)(a.Z,{lang:"js",children:n.texts[71].value}),(0,e.jsx)("p",{children:n.texts[72].value}),(0,e.jsxs)("p",{children:[n.texts[73].value,(0,e.jsx)("code",{children:n.texts[74].value}),n.texts[75].value]}),(0,e.jsxs)("h2",{id:"\u6700\u540E",children:[(0,e.jsx)("a",{"aria-hidden":"true",tabIndex:"-1",href:"#\u6700\u540E",children:(0,e.jsx)("span",{className:"icon icon-link"})}),"\u6700\u540E"]}),(0,e.jsx)("p",{children:n.texts[76].value}),(0,e.jsxs)("ol",{children:[(0,e.jsx)("li",{children:n.texts[77].value}),(0,e.jsx)("li",{children:n.texts[78].value}),(0,e.jsx)("li",{children:n.texts[79].value}),(0,e.jsx)("li",{children:n.texts[80].value}),(0,e.jsx)("li",{children:n.texts[81].value}),(0,e.jsx)("li",{children:n.texts[82].value})]}),(0,e.jsx)("p",{children:n.texts[83].value})]})})})})}s.default=c},16485:function(o,s,t){t.r(s),t.d(s,{texts:function(){return r}});const r=[{value:"\u672C\u7BC7\u6211\u4EEC\u63A5\u7740\u4E0A\u7BC7\uFF0C\u5B9E\u73B0\u6E05\u5355\u4E2D\u4EFB\u52A1\u7684\u521B\u5EFA\u548C\u5B8C\u6210\u3002",paraId:0,tocIndex:0},{value:"\u6211\u4EEC\u9996\u5148\u5B9A\u4E49\u4EFB\u52A1\u76F8\u5173\u7684\u6570\u636E\u5E93\u5B57\u6BB5\uFF0C\u4FEE\u6539 ",paraId:1,tocIndex:2},{value:"prisma/schema.prisma",paraId:1,tocIndex:2},{value:"\uFF0C\u5B8C\u6574\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:1,tocIndex:2},{value:`// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model List {
    id        Int      @id @default(autoincrement())
    name      String
    userId    String
    color     String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    tasks Task[]
}

model Task {
    id        Int       @id @default(autoincrement())
    content   String
    userId    String
    done      Boolean   @default(false)
    expiresAt DateTime?
    createdAt DateTime  @default(now())

    ListId Int
    list   List @relation(fields: [ListId], references: [id], onDelete: Cascade)
}
`,paraId:2,tocIndex:2},{value:"\u56E0\u4E3A\u4FEE\u6539\u4E86 Schema\uFF0C\u6240\u4EE5\u8FD0\u884C\u4EE5\u4E0B\u547D\u4EE4\u540C\u6B65\u6570\u636E\u5E93\uFF1A",paraId:3,tocIndex:2},{value:`npx prisma migrate dev
`,paraId:4,tocIndex:2},{value:"\u4FEE\u6539 ",paraId:5,tocIndex:3},{value:"src/components/CheckListFooter.tsx",paraId:5,tocIndex:3},{value:"\uFF0C\u6DFB\u52A0\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:5,tocIndex:3},{value:`"use client";
// ...
+ import CreateTaskModal from "@/components/CreateTaskModal";
// ...
export default function CheckListFooter({ checkList }: Props) {

  // ...
  return (
    <>
      <Separator />
      <footer className="flex h-[60px] w-full items-center justify-between text-sm text-white">
        <p>\u521B\u5EFA\u4E8E {createdAt.toLocaleDateString("zh-CN")}</p>
        <div>
-          <Button size={"icon"} variant={"ghost"}>
-            <CirclePlus />
-          </Button>
+          <CreateTaskModal checkList={checkList} />
          // ...
        </div>
      </footer>
    </>
  );
}
`,paraId:6,tocIndex:3},{value:"\u5728\u8FD9\u6BB5\u4EE3\u7801\u4E2D\uFF0C\u6211\u4EEC\u5C06\u521B\u5EFA\u4EFB\u52A1\u8868\u5355\u7684\u4EE3\u7801\u653E\u5230 ",paraId:7,tocIndex:3},{value:"<CreateTaskModal>",paraId:7,tocIndex:3},{value:" \u7EC4\u4EF6\u4E2D\u3002",paraId:7,tocIndex:3},{value:"\u65B0\u5EFA ",paraId:8,tocIndex:3},{value:"src/components/CreateTaskModal.tsx",paraId:8,tocIndex:3},{value:"\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:8,tocIndex:3},{value:`'use client';

import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from './ui/form';
import { Button } from '@/components/ui/button';
import { toast } from '@/components/ui/use-toast';
import { Input } from '@/components/ui/input';
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from '@/components/ui/popover';
import { Calendar } from '@/components/ui/calendar';
import { CalendarDays, CirclePlus } from 'lucide-react';

import { type List } from '@prisma/client';
import { useState } from 'react';
import { useForm } from 'react-hook-form';
import dayjs from 'dayjs';
import {
  createTaskZodSchema,
  type createTaskZodSchemaType,
} from '@/schema/createTask';
import { zodResolver } from '@hookform/resolvers/zod';

import { ListMap } from '@/lib/const';
import { cn } from '@/lib/utils';

interface Props {
  checkList: List;
}

export default function CreateTaskModal({ checkList }: Props) {
  const { id, name, color } = checkList;

  const [open, setOpen] = useState(false);

  const form =
    useForm <
    createTaskZodSchemaType >
    {
      resolver: zodResolver(createTaskZodSchema),
      defaultValues: {
        content: '',
        todoId: id,
      },
    };

  const onOpenChange = (open: boolean) => {
    form.reset();
    setOpen(open);
  };

  const onSubmit = async (data: createTaskZodSchemaType) => {
    try {
      console.log(data);
      toast({
        title: '\u64CD\u4F5C\u6210\u529F',
        description: '\u4EFB\u52A1\u5DF2\u7ECF\u6DFB\u52A0\uFF01',
      });
      onOpenChange(false);
    } catch (e) {
      toast({
        title: '\u64CD\u4F5C\u5931\u8D25',
        description: '\u4EFB\u52A1\u521B\u5EFA\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5',
        variant: 'destructive',
      });
    }
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogTrigger asChild>
        <Button size={'icon'} variant={'ghost'}>
          <CirclePlus />
        </Button>
      </DialogTrigger>
      <DialogContent className="sm:max-w-[425px]">
        <DialogHeader>
          <DialogTitle>\u6DFB\u52A0\u4EFB\u52A1</DialogTitle>
          <DialogDescription>\u4EFB\u52A1\u5C06\u6DFB\u52A0\u5230 \u300C{name}\u300D \u6E05\u5355</DialogDescription>
        </DialogHeader>
        <div className="grid gap-4 py-4">
          <Form {...form}>
            <form
              className="flex flex-col space-y-4"
              onSubmit={form.handleSubmit(onSubmit)}
            >
              <FormField
                control={form.control}
                name="content"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>\u4EFB\u52A1\u5185\u5BB9\uFF1A</FormLabel>
                    <FormControl>
                      <Input className="col-span-3" {...field} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />
              <FormField
                control={form.control}
                name="expiresAt"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>\u622A\u6B62\u65E5\u671F\uFF1A</FormLabel>
                    <FormControl>
                      <Popover>
                        <PopoverTrigger asChild>
                          <Button
                            variant={'outline'}
                            className={cn(
                              'w-full justify-start text-left font-normal',
                              !field.value && 'text-muted-foreground',
                            )}
                          >
                            <CalendarDays className="mr-2 h-4 w-4" />
                            {field.value &&
                              dayjs(field.value).format('YYYY/MM/DD')}
                          </Button>
                        </PopoverTrigger>
                        <PopoverContent>
                          <Calendar
                            mode="single"
                            selected={field.value}
                            onSelect={field.onChange}
                            initialFocus
                          />
                        </PopoverContent>
                      </Popover>
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />
            </form>
          </Form>
        </div>
        <DialogFooter>
          <Button
            disabled={form.formState.isSubmitting}
            className={cn(
              'w-full text-white dark:text-white',
              ListMap.get(color),
            )}
            onClick={form.handleSubmit(onSubmit)}
          >
            \u786E\u8BA4
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
`,paraId:9,tocIndex:3},{value:"\u8FD9\u6BB5\u4EE3\u7801\u8DDF\u4E0A\u8282\u521B\u5EFA\u6E05\u5355\u5F88\u50CF\uFF0C\u6211\u4EEC\u4F7F\u7528 React Hook Form \u548C Zod \u505A\u524D\u7AEF\u6570\u636E\u6821\u9A8C\uFF0C\u5F53\u63D0\u4EA4\u7684\u6570\u636E\u901A\u8FC7\u6821\u9A8C\u7684\u65F6\u5019\uFF0C\u4F7F\u7528 ",paraId:10,tocIndex:3},{value:"toast()",paraId:10,tocIndex:3},{value:"\u63D0\u793A\u4FE1\u606F\u3002",paraId:10,tocIndex:3},{value:"\u56E0\u4E3A\u9700\u8981\u5904\u7406\u65F6\u95F4\uFF0C\u5B89\u88C5 ",paraId:11,tocIndex:3},{value:"dayjs",paraId:11,tocIndex:3},{value:"\uFF1A",paraId:11,tocIndex:3},{value:`npm i dayjs
`,paraId:12,tocIndex:3},{value:"\u8FDB\u884C\u6570\u636E\u6821\u9A8C\u9700\u8981\u5148\u5B9A\u4E49 Zod Schema\uFF0C\u65B0\u5EFA ",paraId:13,tocIndex:3},{value:"src/schema/createTask.ts",paraId:13,tocIndex:3},{value:"\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:13,tocIndex:3},{value:`import { z } from 'zod';

export const createTaskZodSchema = z.object({
  todoId: z.number().nonnegative(),
  content: z.string().min(1, {
    message: '\u8BF7\u586B\u5199\u4EFB\u52A1\u5185\u5BB9',
  }),
  expiresAt: z.date().optional(),
});

export type createTaskZodSchemaType = z.infer<typeof createTaskZodSchema>;
`,paraId:14,tocIndex:3},{value:"\u6B64\u65F6\u6D4F\u89C8\u5668\u6548\u679C\u5982\u4E0B\uFF1A",paraId:15,tocIndex:3},{value:"\u6B64\u65F6\u6211\u4EEC\u5DF2\u7ECF\u5B8C\u6210\u4E86\u524D\u53F0\u754C\u9762\u7684\u5C55\u793A\uFF0C\u63A5\u4E0B\u6765\u5B9E\u73B0\u5177\u4F53\u7684\u670D\u52A1\u7AEF\u903B\u8F91\u3002",paraId:16,tocIndex:3},{value:"\u65B0\u5EFA ",paraId:17,tocIndex:4},{value:"src/actions/task.ts",paraId:17,tocIndex:4},{value:"\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:17,tocIndex:4},{value:`'use server';

import { currentUser } from '@clerk/nextjs/server';
import { revalidatePath } from 'next/cache';
import prisma from '@/lib/prisma';
import {
  createTaskZodSchema,
  type createTaskZodSchemaType,
} from '@/schema/createTask';

export async function createTask(data: createTaskZodSchemaType) {
  const user = await currentUser();

  if (!user) {
    throw new Error('\u7528\u6237\u672A\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55');
  }

  const result = createTaskZodSchema.safeParse(data);

  if (!result.success) {
    return {
      success: false,
      message: result.error.flatten().fieldErrors,
    };
  }

  const { content, expiresAt, todoId } = data;

  await prisma.task.create({
    data: {
      userId: user.id,
      content,
      expiresAt,
      list: {
        connect: {
          id: todoId,
        },
      },
    },
  });

  revalidatePath('/');
}
`,paraId:18,tocIndex:4},{value:"\u4FEE\u6539 ",paraId:19,tocIndex:4},{value:"src/components/CreateTaskModal.tsx",paraId:19,tocIndex:4},{value:"\uFF0C\u6DFB\u52A0\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:19,tocIndex:4},{value:`+ import { createTask } from "@/actions/task";

  const onSubmit = async (data: createTaskZodSchemaType) => {
    try {
-      console.log(data);
+      await createTask(data);
      toast({
        title: "\u64CD\u4F5C\u6210\u529F",
        description: "\u4EFB\u52A1\u5DF2\u7ECF\u6DFB\u52A0\uFF01",
      });
      onOpenChange(false);
    } catch (e) {
      toast({
        title: "\u64CD\u4F5C\u5931\u8D25",
        description: "\u4EFB\u52A1\u521B\u5EFA\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",
        variant: "destructive",
      });
    }
  };
`,paraId:20,tocIndex:4},{value:"\u6B64\u65F6\u6211\u4EEC\u5C31\u5B8C\u6210\u4E86\u6E05\u5355\u7684\u521B\u5EFA\uFF0C\u6D4F\u89C8\u5668\u6548\u679C\u5982\u4E0B\uFF1A",paraId:21,tocIndex:4},{value:"\u6548\u679C\u63CF\u8FF0\uFF1A\u6211\u4EEC\u53EF\u4EE5\u5728 prisma studio \u4E2D\u67E5\u770B\u65B0\u589E\u7684\u6570\u636E\u3002",paraId:22,tocIndex:4},{value:"\u4FEE\u6539 ",paraId:23,tocIndex:5},{value:"src/components/CheckLists.tsx",paraId:23,tocIndex:5},{value:"\uFF0C\u5B8C\u6574\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:23,tocIndex:5},{value:`import prisma from '@/lib/prisma';
import { currentUser } from '@clerk/nextjs/server';
import { type Task, type List } from '@prisma/client';
import {
  Card,
  CardContent,
  CardFooter,
  CardHeader,
  CardTitle,
} from '@/components/ui/card';
import CheckListFooter from '@/components/CheckListFooter';

import { cn } from '@/lib/utils';
import { ListMap } from '@/lib/const';
import TaskItem from '@/components/TaskItem';

interface Props {
  checkList: List & {
    tasks: Task[],
  };
}

function CheckList({ checkList }: Props) {
  const { name, color, tasks } = checkList;

  return (
    <Card
      className={cn('w-full text-white sm:col-span-2', ListMap.get(color))}
      x-chunk="dashboard-05-chunk-0"
    >
      <CardHeader>
        <CardTitle>{name}</CardTitle>
      </CardHeader>
      <CardContent>
        {tasks.length === 0 && <p>\u76EE\u524D\u6CA1\u6709\u4EFB\u52A1</p>}
        {tasks.length > 0 && (
          <div>
            {tasks.map((task) => {
              return <TaskItem key={task.id} task={task} />;
            })}
          </div>
        )}
      </CardContent>
      <CardFooter className="flex-col pb-2">
        <CheckListFooter checkList={checkList} />
      </CardFooter>
    </Card>
  );
}

export async function CheckLists() {
  const user = await currentUser();
  const checkLists = await prisma.list.findMany({
    include: {
      tasks: true,
    },
    where: {
      userId: user?.id,
    },
  });

  if (checkLists.length === 0) {
    return <div className="mt-4">\u5C1A\u672A\u521B\u5EFA\u6E05\u5355\uFF0C\u8D76\u7D27\u521B\u5EFA\u4E00\u4E2A\u5427!</div>;
  }

  return (
    <>
      <div className="mt-6 flex w-full flex-col gap-4">
        {checkLists.map((checkList) => (
          <CheckList key={checkList.id} checkList={checkList} />
        ))}
      </div>
    </>
  );
}
`,paraId:24,tocIndex:5},{value:"\u65B0\u5EFA ",paraId:25,tocIndex:5},{value:"src/components/TaskItem.tsx",paraId:25,tocIndex:5},{value:"\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:25,tocIndex:5},{value:`'use client';

import { Checkbox } from '@/components/ui/checkbox';
import dayjs from 'dayjs';
import { type Task } from '@prisma/client';
import { cn } from '@/lib/utils';

function TaskItem({ task }: { task: Task }) {
  return (
    <div className="flex items-center gap-2">
      <Checkbox
        id={task.id.toString()}
        className="h-5 w-5 bg-white"
        checked={task.done}
        onCheckedChange={async (value) => {
          console.log(value);
        }}
      />
      <label
        htmlFor={task.id.toString()}
        className={cn(
          'flex flex-row items-center gap-2',
          task.done && 'line-through',
        )}
      >
        {task.content}
        {task.expiresAt && (
          <p
            className={cn('text-xs text-white', {
              'text-red-800': Date.now() - task.expiresAt.getTime() > 0,
            })}
          >
            {dayjs(task.expiresAt).format('DD/MM/YYYY')}
          </p>
        )}
      </label>
    </div>
  );
}

export default TaskItem;
`,paraId:26,tocIndex:5},{value:"\u6D4F\u89C8\u5668\u6548\u679C\u5982\u4E0B\uFF1A",paraId:27,tocIndex:5},{value:"\u4FEE\u6539 ",paraId:28,tocIndex:6},{value:"src/actions/task.ts",paraId:28,tocIndex:6},{value:"\uFF0C\u6DFB\u52A0\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:28,tocIndex:6},{value:`// ...

export async function setTaskDone(id: number) {
  const user = await currentUser();

  if (!user) {
    throw new Error('\u7528\u6237\u672A\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55');
  }

  await prisma.task.update({
    where: {
      id: id,
      userId: user.id,
    },
    data: {
      done: true,
    },
  });

  revalidatePath('/');
}
`,paraId:29,tocIndex:6},{value:"\u4FEE\u6539 ",paraId:30,tocIndex:6},{value:"src/components/TaskItem.tsx",paraId:30,tocIndex:6},{value:"\uFF0C\u6DFB\u52A0\u4EE3\u7801\u5982\u4E0B\uFF1A",paraId:30,tocIndex:6},{value:`'use client';

import { Checkbox } from '@/components/ui/checkbox';
import dayjs from 'dayjs';
import { type Task } from '@prisma/client';
import { cn } from '@/lib/utils';
import { setTaskDone } from '@/actions/task';

function TaskItem({ task }: { task: Task }) {
  return (
    <div className="flex items-center gap-2">
      <Checkbox
        id={task.id.toString()}
        className="h-5 w-5 bg-white"
        checked={task.done}
        onCheckedChange={async () => {
          await setTaskDone(task.id);
        }}
      />
      <label
        htmlFor={task.id.toString()}
        className={cn(
          'flex flex-row items-center gap-2',
          task.done && 'line-through',
        )}
      >
        {task.content}
        {task.expiresAt && (
          <p
            className={cn('text-xs text-white', {
              'text-red-800': Date.now() - task.expiresAt.getTime() > 0,
            })}
          >
            {dayjs(task.expiresAt).format('DD/MM/YYYY')}
          </p>
        )}
      </label>
    </div>
  );
}

export default TaskItem;
`,paraId:31,tocIndex:6},{value:"\u6D4F\u89C8\u5668\u6548\u679C\u5982\u4E0B\uFF1A",paraId:32,tocIndex:6},{value:"\u5047\u8BBE\u9879\u76EE\u5F00\u53D1\u5B8C\u6BD5\uFF0C\u51C6\u5907\u4E0A\u7EBF\u3002\u8FD0\u884C\uFF1A",paraId:33,tocIndex:7},{value:`npm run build
`,paraId:34,tocIndex:7},{value:"\u4F60\u4F1A\u53D1\u73B0\u4F1A\u6709\u4E00\u4E9B TypeScipt \u9519\u8BEF\u51FA\u73B0\u3002\u4E3B\u8981\u96C6\u4E2D\u5728 Shadcn UI \u7684\u7EC4\u4EF6\u4EE3\u7801\u4E2D\u3002\u8FD9\u662F Shadcn UI \u548C t3-app \u4EE3\u7801\u98CE\u683C\u4E0D\u4E00\u6837\u5BFC\u81F4\uFF0C\u6682\u65F6\u4E24\u8FB9\u90FD\u6CA1\u6709\u89E3\u51B3\u3002",paraId:35,tocIndex:7},{value:"\u4E3A\u4E86\u907F\u514D\u8FD9\u4E9B\u9519\u8BEF\u5BFC\u81F4\u6784\u5EFA\u5931\u8D25\uFF0C\u4F60\u53EF\u4EE5\uFF1A",paraId:36,tocIndex:7},{value:"\u5220\u9664 ",paraId:37,tocIndex:7},{value:"components/ui/chart.tsx",paraId:37,tocIndex:7},{value:" \u548C ",paraId:37,tocIndex:7},{value:"components/ui/input-otp.tsx",paraId:37,tocIndex:7},{value:"\u8FD9\u4E24\u4E2A\u6CA1\u6709\u7528\u5230\u7684\u7EC4\u4EF6",paraId:37,tocIndex:7},{value:"\u4FEE\u6539 ",paraId:37,tocIndex:7},{value:"next-t3-todo/.eslintrc.cjs",paraId:37,tocIndex:7},{value:"\uFF0C\u6DFB\u52A0\u89C4\u5219\u5982\u4E0B\uFF1A",paraId:37,tocIndex:7},{value:`/** @type {import("eslint").Linter.Config} */
const config = {
  // ...
  rules: {
    // ...
    '@typescript-eslint/no-empty-interface': [
      'error',
      { allowSingleExtends: true },
    ],
    '@typescript-eslint/prefer-nullish-coalescing': 'warn',
  },
};
module.exports = config;
`,paraId:38,tocIndex:7},{value:"\u6B64\u65F6\u5E94\u8BE5\u53EF\u4EE5\u901A\u8FC7 TypeScript \u6821\u9A8C\u3002",paraId:39,tocIndex:7},{value:"\u5F53\u7136\u4F60\u4E5F\u53EF\u4EE5\u7981\u7528\u67D0\u4E9B\u89C4\u5219\u3001\u6216\u8005\u8BBE\u7F6E ",paraId:40,tocIndex:7},{value:"next.config.js",paraId:40,tocIndex:7},{value:" \u7684\u914D\u7F6E\u9879\uFF0C\u5373\u4F7F\u6709\u9519\u8BEF\u4E5F\u7EE7\u7EED\u6784\u5EFA\u3002",paraId:40,tocIndex:7},{value:"\u5C31\u6211\u4E2A\u4EBA\u611F\u89C9\uFF0C\u5F53\u524D Next.js \u6700\u6D41\u884C\u7684\u6280\u672F\u9009\u578B\u5C31\u662F\u8FD9\u5957\u4E86\uFF1A",paraId:41,tocIndex:8},{value:"Next.js App Router + Server Actions",paraId:42,tocIndex:8},{value:"Typescript",paraId:42,tocIndex:8},{value:"Tailwind CSS",paraId:42,tocIndex:8},{value:"Prisma / Drizzle",paraId:42,tocIndex:8},{value:"Zod + Shadcn UI + React Hook Form",paraId:42,tocIndex:8},{value:"Clerk / Supabase / Next-Auth",paraId:42,tocIndex:8},{value:"\u719F\u6089\u8FD9\u5957\u6280\u672F\u9009\u578B\u53EF\u4EE5\u66F4\u9AD8\u6548\u7684\u5E2E\u52A9\u6211\u4EEC\u5F00\u53D1 Next.js \u9879\u76EE\u3002",paraId:43,tocIndex:8}]}}]);
